/*! lucca-ui 24-03-2016 */
!function(){"use strict";angular.module("moment",[]).factory("moment",function(){return window.moment}),angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("lui.directives",["pascalprecht.translate","moment","underscore","ui.select","ui.bootstrap"]),angular.module("lui.filters",["moment"]),angular.module("lui.services",[]),angular.module("lui.templates.momentpicker",[]),angular.module("lui.templates.daterangepicker",[]),angular.module("lui.templates.translationsinput",[]),angular.module("lui.templates",["lui.templates.momentpicker","lui.templates.daterangepicker","lui.templates.translationsinput"]),angular.module("lui.translates.userpicker",[]),angular.module("lui.translates.daterangepicker",[]),angular.module("lui.translates",["pascalprecht.translate","lui.translates.userpicker","lui.translates.daterangepicker"]),angular.module("lui",["lui.directives","lui.services","lui.filters","lui.templates","lui.translates"])}(),function(){"use strict";angular.module("lui.directives").directive("luidDaterange",["moment","$filter","$document","$timeout",function(a,b,c,d){function e(e,f,g,h){function i(b,c){var d=e.startProperty||"startsOn",f=e.endProperty||"endsOn",g={},h=a(b),i=a(c);switch(e.excludeEnd&&i.add(1,"d"),e.format||"moment"){case"moment":g[d]=h,g[f]=i;break;case"date":g[d]=h.toDate(),g[f]=i.toDate();break;default:g[d]=h.format(e.format),g[f]=i.format(e.format)}return g}function j(b){var c,d,f=e.startProperty||"startsOn",g=e.endProperty||"endsOn";switch(e.format||"moment"){case"moment":case"date":c=a(b[f]),d=a(b[g]);break;default:c=a(b[f],e.format),d=a(b[g],e.format)}return e.excludeEnd&&d.add(-1,"d"),{startsOn:c.toDate(),endsOn:d.toDate()}}function k(){e.popoverOpened=!1,m.unpinPopover(),e.$apply()}var l=h[1],m=h[0];e.internal={},e.hasPeriods=!!g.periods,l.$render=function(){if(!l.$viewValue)return e.internal.startsOn=void 0,e.internal.endsOn=void 0,void(e.internal.strFriendly=void 0);var a=j(l.$viewValue);e.internal.startsOn=a.startsOn,e.internal.endsOn=a.endsOn,e.internal.strFriendly=b("luifFriendlyRange")(e.internal)},e.$watch(function(a){return l.$viewValue[a.startProperty||"startsOn"]},function(){l.$render()}),e.$watch(function(a){return l.$viewValue[a.endProperty||"endsOn"]},function(){l.$render()}),m.updateValue=function(a,b){var c=l.$viewValue,d=i(a,b);c[Object.keys(d)[0]]=d[Object.keys(d)[0]],c[Object.keys(d)[1]]=d[Object.keys(d)[1]],l.$setViewValue(c),e.$parent.$eval(g.ngChange)},m.pinPopover=function(){d(function(){c.on("click",k)},10)},m.unpinPopover=function(){c.off("click",k)}}return{require:["luidDaterange","^ngModel"],controller:"luidDaterangeController",scope:{disabled:"=",format:"@",startProperty:"@",endProperty:"@",popoverPlacement:"@",excludeEnd:"=",periods:"=",closeLabel:"@",closeAction:"&"},templateUrl:"lui/directives/luidDaterange.html",restrict:"EA",link:e}}]).controller("luidDaterangeController",["$scope","moment","$filter",function(a,b,c){var d=this;a.startingDay=b.localeData().firstDayOfWeek(),a.internalUpdated=function(){b(a.internal.startsOn).diff(a.internal.endsOn)>0&&(a.internal.endsOn=b(a.internal.startsOn)),a.hackRefresh=!a.hackRefresh,d.updateValue(a.internal.startsOn,a.internal.endsOn),a.internal.strFriendly=c("luifFriendlyRange")(a.internal)},a.goToPeriod=function(c){a.internal.startsOn=b(c.startsOn).toDate(),a.internal.endsOn=b(c.endsOn).toDate(),a.excludeEnd&&(a.internal.endsOn=b(c.endsOn).add(-1,"day").toDate()),a.internalUpdated()},a.popoverOpened=!1,a.togglePopover=function(){a.popoverOpened=!a.popoverOpened,a.popoverOpened?d.pinPopover():d.unpinPopover()},a.doCloseAction=function(){a.togglePopover(),a.closeAction&&a.closeAction()},a.clickInside=function(a){a.preventDefault(),a.stopPropagation()},a.dayClass=function(c,d){var e="";return"day"==d&&(0===b(c).diff(a.internal.startsOn)&&(e="start"),0===b(c).diff(a.internal.endsOn)&&(e+="end"),b(c).isAfter(a.internal.startsOn)&&b(c).isBefore(a.internal.endsOn)&&(e+="in-between")),e}}]),angular.module("lui.templates.daterangepicker").run(["$templateCache",function(a){a.put("lui/directives/luidDaterange.html","<input ng-model='internal.strFriendly' ng-disabled='disabled || popoverOpen' ng-click='togglePopover()'uib-popover-template=\"'lui/directives/luidDaterangePopover.html'\"popover-placement=\"{{popoverPlacement}}\"popover-trigger ='none' popover-is-open='popoverOpened'popover-class ='lui daterange popover {{hasPeriods?\"has-periods\":\"\"}}'>"),a.put("lui/directives/luidDaterangePopover.html",'<div class="lui clear" ng-click="clickInside($event)">	<div class="lui vertical pills shortcuts menu">'+"		<a class='lui item' ng-repeat='period in periods' ng-click='goToPeriod(period)'>{{period.label}}</a>	</div>	<uib-datepicker ng-if='hackRefresh' class='lui datepicker start-date' ng-model='internal.startsOn' show-weeks='false' custom-class='dayClass(date, mode)' starting-day='startingDay' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='hackRefresh' class='lui datepicker end-date' ng-model='internal.endsOn' show-weeks='false' min-date='internal.startsOn' custom-class='dayClass(date, mode)' starting-day='startingDay' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='!hackRefresh' class='lui datepicker start-date' ng-model='internal.startsOn' show-weeks='false' custom-class='dayClass(date, mode)' starting-day='startingDay' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='!hackRefresh' class='lui datepicker end-date' ng-model='internal.endsOn' show-weeks='false' min-date='internal.startsOn' custom-class='dayClass(date, mode)' starting-day='startingDay' ng-change='internalUpdated()'></uib-datepicker>	<hr>	<a class='lui right pulled primary button' ng-click='doCloseAction()'>{{closeLabel || 'Ok'}}</a></div>")}])}(),function(){"use strict";var a=function(){return{template:'<div><div ng-style="controller.weekdayStyleOverride()" ng-if = "controller.showDay" class="weekday">{{controller.date | luifMoment: \'dddd\'}}</div><div ng-style="controller.dayStyleOverride()" class="day">{{controller.date | luifMoment:\'DD\'}}</div><div ng-style="controller.monthStyleOverride()" class="month">{{controller.date | luifMoment: \'MMM\' | limitTo : 3}}</div><div ng-style="controller.yearStyleOverride()" class="year">{{controller.date | luifMoment: \'YYYY\'}}</div></div>',scope:{date:"=",showDay:"=",primaryColor:"=",secondaryColor:"="},restrict:"E",bindToController:!0,controllerAs:"controller",controller:"luidDayBlockController"}};angular.module("lui.directives").directive("luidDayBlock",a).controller("luidDayBlockController",function(){var a=this;a.weekdayStyleOverride=function(){return{color:a.primaryColor}},a.dayStyleOverride=function(){return{"background-color":a.primaryColor,"border-color":a.primaryColor,color:a.secondaryColor}},a.monthStyleOverride=function(){return{"background-color":a.secondaryColor,"border-color":a.primaryColor,color:a.primaryColor}},a.yearStyleOverride=function(){return{"background-color":a.secondaryColor,"border-color":a.primaryColor,color:a.primaryColor}}})}(),function(){"use strict";angular.module("lui.directives").directive("luidKeydown",function(){return{restrict:"A",scope:{mappings:"="},link:function(a,b,c){b.on("keydown",function(b){a.mappings&&a.mappings[b.which]&&(a.mappings[b.which](),b.preventDefault())})}}}),angular.module("lui.directives").directive("luidSelectOnClick",function(){return{restrict:"A",link:function(a,b,c){b.on("click",function(){this.select()}),b.on("focus",function(){this.select()})}}}),angular.module("lui.directives").directive("luidFocusOn",function(){return function(a,b,c){a.$on(c.luidFocusOn,function(a){b[0].focus()})}})}(),function(){"use strict";angular.module("lui.directives").directive("luidSelect",[function(){return{require:"^ngModel",scope:{options:"=",placeholder:"@",displayProp:"@",ngDisabled:"=",classes:"@",onSelect:"&",onRemove:"&"},restrict:"E",template:'<ui-select theme="bootstrap" on-select="onSelect()" on-remove="onRemove()" class="lui nguibs-ui-select {{classes}}" ng-disabled="ngDisabled">	<ui-select-match placeholder="{{placeholder}}">{{$select.selected[displayProp]}}</ui-select-match>	<ui-select-choices repeat="option in options | filter: $select.search">		<div ng-bind-html="option[displayProp] | highlight: $select.search"></div>	</ui-select-choices></ui-select>'}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidMoment",["moment",function(a){function b(b,c,d,e){var f=e[1],g=e[0];if(b.hasButtons=void 0!==d.showButtons,d.format){var h=b.$eval(d.format);f.$render=function(){var c=a(this.$viewValue,h),d=this.$viewValue&&c.isValid();b.hours=d?c.format("HH"):void 0,b.mins=d?c.format("mm"):void 0,f.$validate()},f.setValue=function(a){f.$setViewValue(a?a.format(h):void 0)},f.$validators.min=function(b,c){return!c||g.checkMin(a(b,h))},f.$validators.max=function(b,c){return!c||g.checkMax(a(b,h))}}else f.$render=function(){var a=this.$viewValue&&!!this.$viewValue.isValid&&this.$viewValue.isValid();b.hours=a?this.$viewValue.format("HH"):void 0,b.mins=a?this.$viewValue.format("mm"):void 0,f.$validate()},f.setValue=function(a){f.$setViewValue(a)},f.$validators.min=function(a,b){return!b||g.checkMin(a)},f.$validators.max=function(a,b){return!b||g.checkMax(a)};b.ngModelCtrl=f,f.$validators.hours=function(a,c){return void 0!==b.hours&&""!==b.hours&&!isNaN(parseInt(b.hours))},f.$validators.minutes=function(a,c){return void 0!==b.mins&&""!==b.mins&&parseInt(b.mins)<60};var i=c.find("input");g.setupEvents(angular.element(i[0]),angular.element(i[1])),b.$watch("min",function(){f.$validate()}),b.$watch("max",function(){f.$validate()})}return{require:["luidMoment","^ngModel"],controller:"luidMomentController",scope:{min:"=",max:"=",step:"=",referenceDate:"=",disabled:"=",showButtons:"=",enforceValid:"=",format:"=",minOffset:"=",maxOffset:"="},templateUrl:"lui/directives/luidMoment.html",restrict:"EA",link:b}}]).controller("luidMomentController",["$scope","$timeout","moment",function(a,b,c){function d(b){function d(){function a(a,b){return-1!==a.indexOf(b)}var d=c(p());d&&d.isValid()||(d=l().startOf("day")),a(w,Math.abs(b))&&d.minutes()%b!==0&&(b=0>b?-(d.minutes()%b):-d.minutes()%b+b);var e=d.add(b,"m");return e.seconds(0),e}a.disabled||e(d(),!0)}function e(b,c){f(b,c),a.ngModelCtrl.$render()}function f(b,c){function d(a,b,c){switch(!0){case!a:return a;case b&&b.diff(a)>0:return b;case c&&c.diff(a)<0:return c;default:return a}}var e=n(),f=o();c&&(b=d(b,e,f)),a.maxed=b&&f&&f.diff(b)<=0,a.mined=b&&e&&e.diff(b)>=0,a.ngModelCtrl.setValue(b)}function g(){return void 0===a.hours||""===a.hours||void 0===a.mins||""===a.mins}function h(){if(!g()){var b=parseInt(a.hours),c=parseInt(a.mins);return c>60&&(c=59,a.mins="59"),l().hours(b).minutes(c).seconds(0)}}function i(){function a(a){a&&(b.cancel(a),a=void 0)}a(u),a(v)}function j(){e(p(),a.enforceValid)}function k(){return isNaN(parseInt(a.step))?5:parseInt(a.step)}function l(){function b(a){return a&&c(a).isValid()?c(a):void 0}return b(a.referenceDate)||b(a.min)||b(a.max)||c()}function m(a,b,d){function e(){switch(!0){case!!a.isValid&&!!a.isValid():return c(a);case c(a,"YYYY-MM-DD HH:mm").isValid():return c(a,"YYYY-MM-DD HH:mm");case c(a,"HH:mm").isValid():var b=l(),e=c(a,"HH:mm").year(b.year()).month(b.month()).date(b.date());return d&&e.hours()+e.minutes()===0&&e.add(1,"d"),e}}if(a){var f=e();return f.add(c.duration(b)),f}}function n(){return m(a.min,a.minOffset,!1)}function o(){return m(a.max,a.maxOffset,!0)}function p(){return a.format?c(a.ngModelCtrl.$viewValue,a.format):a.ngModelCtrl.$viewValue}function q(b,c){i(),d(c),a.$broadcast(b)}function r(b){i(),a.minsFocused=!!b,a.hoursFocused=!b}function s(a,c){a=b(function(){a=!1,j()},200)}function t(a){return void 0===a||""===a}var u,v,w=[5,10,15,20,30];a.pattern=/^([0-9]{0,2})?$/,a.incrHours=function(){q("focusHours",60)},a.decrHours=function(){q("focusHours",-60)},a.incrMins=function(){q("focusMinutes",k())},a.decrMins=function(){q("focusMinutes",-k())},a.changeHours=function(){return t(a.hours)?f(void 0):(t(a.mins)&&(a.mins="00"),2==a.hours.length?(parseInt(a.hours)>23&&(a.hours="23"),a.$broadcast("focusMinutes")):1==a.hours.length&&parseInt(a.hours)>2&&(a.hours=0+a.hours,a.$broadcast("focusMinutes")),void f(h()))},a.changeMins=function(){f(h())},a.formatInputValue=function(){a.ngModelCtrl.$render()},a.getDayGap=function(){var a=l().startOf("day");return c.duration(c(p()).startOf("d").diff(a)).asDays()},a.blurHours=function(){s(u,a.hoursFocused)},a.blurMins=function(){a.mins||(""===a.hours||void 0===a.hours?a.mins=void 0:a.mins="00"),s(v,a.minsFocused)},a.focusHours=function(){r(!1)},a.focusMins=function(){r(!0)},this.checkMin=function(a){var b=n();return!b||b.diff(a)<=0},this.checkMax=function(a){var b=o();return!b||b.diff(a)>=0},this.setupEvents=function(b,c){function e(b,c){function e(b,c){switch(b.which){case 38:b.preventDefault(),d(c),a.$apply();break;case 40:b.preventDefault(),d(-c),a.$apply();break;case 13:b.preventDefault(),a.formatInputValue(),a.$apply()}}var f=k();b.bind("keydown",function(a){e(a,60)}),c.bind("keydown",function(a){e(a,f)})}function f(b,c){function e(a){a=a.originalEvent?a.originalEvent:a;var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0}function f(b,c){a.disabled||(a.$apply(d(e(b)?c:-c)),b.preventDefault())}var g=k();b.bind("mousewheel wheel",function(a){f(a,60)}),c.bind("mousewheel wheel",function(a){f(a,g)})}e(b,c),f(b,c)}}]),angular.module("lui.templates.momentpicker").run(["$templateCache",function(a){a.put("lui/directives/luidMoment.html","<div class='luid-moment' ng-class='{disabled:disabled}'>	<input type='text' ng-model='hours' ng-change='changeHours()' luid-select-on-click ng-pattern='pattern' luid-focus-on='focusHours'   ng-focus='focusHours()' ng-blur='blurHours()' ng-disabled='disabled' maxlength=2> : 	<input type='text' ng-model='mins'  ng-change='changeMins()'  luid-select-on-click ng-pattern='pattern' luid-focus-on='focusMinutes' ng-focus='focusMins()'  ng-blur='blurMins()'  ng-disabled='disabled' maxlength=2>	<i ng-if='hasButtons' ng-click='incrHours()' ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button top left north arrow icon'     ng-class='{disabled:maxed}'></i>	<i ng-if='hasButtons' ng-click='decrHours()' ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button bottom left south arrow icon'  ng-class='{disabled:mined}'></i>	<i ng-if='hasButtons' ng-click='incrMins()'  ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button top right north arrow icon'    ng-class='{disabled:maxed}'></i>	<i ng-if='hasButtons' ng-click='decrMins()'  ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button bottom right south arrow icon' ng-class='{disabled:mined}'></i></div>")}])}(),function(){"use strict";angular.module("lui.directives").directive("luidPercentage",function(){function a(a,b,c,d){var e=d[1],f=d[0];if(a.pattern=/^([0-9]+)(\.([0-9]*)?)?$/i,c.format){if("0.XX"!==c.format&&"1.XX"!==c.format&&"XX"!==c.format)return void(e.$render=function(){a.intPct="unsupported format"})}else a.format="0.XX";a.ngModelCtrl=e,e.$render=function(){return void 0===this.$viewValue?void(a.intPct=void 0):void(a.intPct=a.parse(parseFloat(this.$viewValue)))},e.$viewChangeListeners.push(function(){a.$eval(c.ngChange)}),f.setupEvents(b.find("input"))}return{require:["luidPercentage","^ngModel"],controller:"luidPercentageController",scope:{step:"=",format:"@",ngDisabled:"=",placeholder:"@"},restrict:"EA",link:a,template:"<div class='lui short input with addon'><input class='lui right aligned' type='text' ng-disabled='ngDisabled' placeholder='{{placeholder}}' ng-model='intPct' ng-change='updateValue()' ng-blur='formatInputValue()'><i class='lui right addon'>%</i></div>"}}).controller("luidPercentageController",["$scope",function(a){function b(b){c(parseFloat(a.intPct)+b)}function c(b){d(b),a.ngModelCtrl.$render()}function d(b){function c(b){switch(a.format||"0.XX"){case"XX":return b;case"0.XX":return b/100;case"1.XX":return b/100+1;default:return 0}}var d=void 0===b?void 0:c(b);a.ngModelCtrl.$setViewValue(d)}this.setupEvents=function(c){function d(){return isNaN(parseInt(a.step))?5:parseInt(a.step)}function e(c){var e=d();c.bind("keydown",function(c){switch(c.which){case 38:c.preventDefault(),b(e),a.$apply();break;case 40:c.preventDefault(),b(-e),a.$apply();break;case 13:c.preventDefault(),a.formatInputValue(),a.$apply()}})}function f(c){function e(a){a=a.originalEvent?a.originalEvent:a;var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0}var f=d();c.bind("mousewheel wheel",function(c){this===document.activeElement&&(a.$apply(b(e(c)?f:-f)),c.preventDefault())})}e(c),f(c)},a.updateValue=function(){d(a.intPct)},a.parse=function(b){switch(a.format||"0.XX"){case"XX":return b;case"0.XX":return Math.round(1e4*b)/100;case"1.XX":return Math.round(1e4*(b-1))/100;default:return 0}},a.formatInputValue=function(){a.ngModelCtrl.$render()}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidTimespan",["moment",function(a){function b(b,c,d,e){var f=e[1],g=e[0];if(b.pattern=/^\-?([0-9]+)((h([0-9]{2})?)?(m(in)?)?)?$/i,d.unit){var h=b.$eval(d.unit);"h"!=h&&"hour"!=h&&"hours"!=h||(b.useHours=!0)}b.ngModelCtrl=f,f.$render=function(){if(b.strDuration="",this.$viewValue){var c=a.duration(this.$viewValue);0>c&&(b.strDuration+="-",c=a.duration(-c));var d=Math.floor(c.asHours()),e=c.minutes();0===d?b.strDuration+=e+"m":b.strDuration+=(10>d?"0":"")+d+"h"+(10>e?"0":"")+e}},g.setupEvents(c.find("input")),g.mode=d.mode?d.mode:"timespan"}return{require:["luidTimespan","^ngModel"],controller:"luidTimespanController",scope:{step:"=",unit:"=",ngDisabled:"=",placeholder:"@",mode:"=",min:"=",max:"="},restrict:"EA",link:b,template:"<input type='text' ng-disabled='ngDisabled' placeholder='{{placeholder}}' ng-pattern='pattern' ng-model='strDuration' ng-change='updateValue()' ng-blur='formatInputValue()'>"}}]).controller("luidTimespanController",["$scope","moment",function(a,b){function c(c){function d(a){var c=b.duration(),d=a.split(/h/i),e=parseInt(d[0])>=0;c.add(parseInt(d[0]),"hours");var f=d[1];return f&&f.length>=2&&(e?c.add(parseInt(f.substring(0,2)),"minutes"):c.subtract(parseInt(f.substring(0,2)),"minutes")),c}function e(a){var c=b.duration(),d=a.split(/m/i);return c.add(parseInt(d[0]),"minutes"),c}function f(a){var c=b.duration(),d=a.split(/h/i);return c.add(parseInt(d[0]),"hours"),c}switch(!0){case/h/i.test(c):return d(c);case/m/i.test(c):return e(c);case a.useHours:return f(c);default:return e(c)}}function d(a){var c=b.duration(g()).add(a,"minutes");c.asMilliseconds()<0&&(c=b.duration()),e(c)}function e(b){f(b),a.ngModelCtrl.$render()}function f(c){function d(c){function d(c){var d=a.min?b.duration(a.min):void 0;return!d||c>=d?c:d}function e(c){var d=a.max?b.duration(a.max):void 0;return!d||d>=c?c:d}return e(d(c))}function e(a){if("timespan"===h.mode){var c="";return a.asMilliseconds()<0&&(c+="-",a=b.duration(-a)),c+=(a.days()>0?Math.floor(a.asDays())+".":"")+(a.hours()<10?"0":"")+a.hours()+":"+(a.minutes()<10?"0":"")+a.minutes()+":00"}return a}if(void 0===c)return a.ngModelCtrl.$setViewValue(void 0);c=d(c);var f=e(c);a.ngModelCtrl.$setViewValue(f)}function g(){return a.ngModelCtrl.$viewValue}var h=this;this.setupEvents=function(b){function c(){return isNaN(parseInt(a.step))?5:parseInt(a.step)}function e(b){var e=c();b.bind("keydown",function(b){switch(b.which){case 38:b.preventDefault(),d(e),a.$apply();break;case 40:b.preventDefault(),d(-e),a.$apply();break;case 13:b.preventDefault(),a.formatInputValue(),a.$apply()}})}function f(b){function e(a){a=a.originalEvent?a.originalEvent:a;var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0}var f=c();b.bind("mousewheel wheel",function(b){this===document.activeElement&&(a.$apply(d(e(b)?f:-f)),b.preventDefault())})}e(b),f(b)},a.updateValue=function(){if(!a.strDuration)return f(void 0);var b=c(a.strDuration);f(b)},a.formatInputValue=function(){a.ngModelCtrl.$render()}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidUserSelect",[function(){return{require:"^ngModel",scope:{users:"=",placeholder:"@",onSelect:"&",onRemove:"&"},restrict:"E",template:'<ui-select theme="bootstrap" on-select="onSelect()" on-remove="onRemove()">	<ui-select-match placeholder="{{placeholder}}">{{$select.selected.displayName}}</ui-select-match>	<ui-select-choices repeat="user in users | filter: $select.search">		<div ng-bind-html="user.displayName"></div>	</ui-select-choices></ui-select>'}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidTranslations",["$translate","_","$filter","$timeout",function(a,b,c,d){function e(c,d,e,f){var g=f[1],h=f[0],i=["en","de","es","fr","it","nl"];c.cultures=i;var j=a.preferredLanguage()||"en";c.currentCulture=j;var k="dictionary";e.mode&&(k=c.mode),"dictionary"===k&&void 0!==g.$viewValue&&b.each(i,function(a){c.$watch(function(){return g.$viewValue[a]},function(){g.$render()})}),g.$render=function(){c.internal=l(g.$viewValue)},h.updateViewValue=function(){switch(k){case"dictionary":return n(c.internal);case"|":case"pipe":return p(c.internal);case"[]":case"brackets":return updateBrackets(c.internal)}};var l=function(a){switch(k){case"dictionary":return m(a);case"|":case"pipe":return o(a);case"[]":case"brackets":return q(a);default:return{}}},m=function(a){return b.reduce(i,function(b,c){return b[c]=a[c],b},{})},n=function(a){b.each(i,function(b){g.$viewValue[b]=a[b]}),g.$setViewValue(g.$viewValue),c.$parent.$eval(e.ngChange)},o=function(a){if(!a)return{};var c=a.split("|"),d={};return b.each(c,function(a){var b=a.substring(0,2),c=a.substring(3);d[b]=c}),b.pick(d,i)},p=function(a){var c=b.map(i,function(b){return a[b]?b+":"+a[b]:b+":"}).join("|");g.$setViewValue(c)},q=function(a){return{}}}return{require:["luidTranslations","^ngModel"],controller:"luidTranslationsController",scope:{mode:"@",size:"@"},templateUrl:"lui/directives/luidTranslations.html",restrict:"EA",replace:!0,link:e}}]).controller("luidTranslationsController",["$scope","$translate","$timeout",function(a,b,c){var d=this;a.update=function(){d.updateViewValue()};var e;a.focusInput=function(){e&&(c.cancel(e),e=void 0),a.focused=!0},a.blurInput=function(){e=c(function(){a.focused=!1},500)}}]),angular.module("lui.templates.translationsinput").run(["$templateCache",function(a){a.put("lui/directives/luidTranslations.html",'<div class="luid-translations {{size}}" ng-class="{open:focused || hovered}" ng-mouseenter="hovered=true" ng-mouseleave="hovered=false">	<div class="lui fitting input with addon">		<input type="text" ng-model="internal[currentCulture]" ng-focus="focusInput()" ng-blur="blurInput()" ng-change="update()">		<span class="lui right addon">{{currentCulture}}</span>	</div>	<div class="lui luid-translations-dropdown">		<div class="lui fitting input with addon" ng-repeat="culture in cultures" ng-if="culture !== currentCulture">			<input type="text" ng-model="internal[culture]" ng-focus="focusInput()" ng-blur="blurInput()" ng-change="update()">			<span class="lui right addon">{{culture}}</span>		</div>	</div></div>')}])}(),function(){"use strict";var a=5,b=1e4,c=[{label:"LUIDUSERPICKER_DEPARTMENT",name:"department.name",icon:"location"},{label:"LUIDUSERPICKER_LEGALENTITY",name:"legalEntity.name",icon:"tree list"},{label:"LUIDUSERPICKER_EMPLOYEENUMBER",name:"employeeNumber",icon:"user"},{label:"LUIDUSERPICKER_MAIL",name:"mail",icon:"email"}],d='<ui-select-choices position="down" repeat="user in users" refresh="find($select.search)" refresh-delay="0" ui-disable-choice="!!user.overflow"><div ng-class="{dividing: user.isDisplayedFirst}"><div ng-if="!!user.isSelected" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info : \'LUIDUSERPICKER_SELECTED\'"></div><div ng-if="!!user.isAll">{{ \'LUIDUSERPICKER_ALL\' | translate }}</div><div ng-if="!!user.isMe" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info : \'LUIDUSERPICKER_ME\'"></div><div ng-if="!user.isDisplayedFirst" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info"></div><small ng-if="!user.overflow && user.hasHomonyms && getProperty(user, property.name)" ng-repeat="property in displayedProperties"><i class="lui icon {{property.icon}}"></i> <b>{{property.label | translate}}</b> {{getProperty(user, property.name)}}<br/></small><small ng-if="showFormerEmployees && user.isFormerEmployee" translate translate-values="{dtContractEnd:user.dtContractEnd}">LUIDUSERPICKER_FORMEREMPLOYEE</small></div><small ng-if="user.overflow" translate translate-values="{cnt:user.cnt, all:user.all}">{{user.overflow}}</small></ui-select-choices>',e='<ui-select theme="bootstrap"class="lui {{size}} input " on-select="onSelect()" on-remove="onRemove()" ng-disabled="controlDisabled"><ui-select-match placeholder="{{ \'LUIDUSERPICKER_PLACEHOLDER\' | translate }}"><div ng-if="!$select.selected.isAll">{{ $select.selected.firstName }} {{$select.selected.lastName}}</div><div ng-if="$select.selected.isAll">{{ \'LUIDUSERPICKER_ALL\' | translate }}</div></ui-select-match>'+d+"</ui-select>",f='<ui-select multiple theme="bootstrap" class="lui {{size}} input" on-select="onSelect()" on-remove="onRemove()" ng-disabled="controlDisabled" close-on-select="false"><ui-select-match placeholder="{{ \'LUIDUSERPICKER_PLACEHOLDER\' | translate }}">{{$item.firstName}} {{$item.lastName}} <small ng-if="$item.hasHomonyms && getProperty($item, property.name)" ng-repeat="property in displayedProperties"><b>{{property.label | translate}}</b> {{getProperty($item, property.name)}} </small><small ng-if="$item.isFormerEmployee" translate  translate-values="{dtContractEnd:user.dtContractEnd}">LUIDUSERPICKER_FORMEREMPLOYEE</small></ui-select-match>'+d+"</ui-select>";angular.module("lui.directives").directive("luidUserPicker",function(){return{restrict:"E",controller:"luidUserPickerController",template:e,require:["luidUserPicker","^ngModel"],scope:{size:"@",onSelect:"&",onRemove:"&",controlDisabled:"=",showFormerEmployees:"=",homonymsProperties:"=",customFilter:"=",appId:"=",operations:"=",customInfo:"=",customInfoAsync:"=",displayMeFirst:"=",displayAllUsers:"="},link:function(a,b,c,d){var e=d[0],f=d[1];e.isMultipleSelect=!1,e.asyncPagination=!1,e.useCustomFilter=!!c.customFilter,e.displayCustomInfo=!!c.customInfo||!!c.customInfoAsync,a.$watch(function(){return(f.$viewValue||{}).id},function(){a.reorderUsers()}),e.getSelectedUsers=function(){return f.$viewValue?[f.$viewValue]:[]},e.getSelectedUserIds=function(){return f.$viewValue?[f.$viewValue.id]:[]}}}}).directive("luidUserPickerMultiple",function(){return{restrict:"E",controller:"luidUserPickerController",template:f,require:["luidUserPickerMultiple","^ngModel"],scope:{size:"@",onSelect:"&",onRemove:"&",controlDisabled:"=",showFormerEmployees:"=",homonymsProperties:"=",customFilter:"=",appId:"=",operations:"=",customInfo:"=",customInfoAsync:"=",displayMeFirst:"="},link:function(a,b,c,d){var e=d[0],f=d[1];e.isMultipleSelect=!0,e.asyncPagination=!1,e.useCustomFilter=!!c.customFilter,e.displayCustomInfo=!!c.customInfo||!!c.customInfoAsync,a.$watchCollection(function(){return f.$viewValue},function(){a.reorderUsers()}),e.getSelectedUsers=function(){return f.$viewValue||[]},e.getSelectedUserIds=function(){return f.$viewValue?_.pluck(f.$viewValue,"id"):[]}}}}).controller("luidUserPickerController",["$scope","$http","moment","$timeout","$q",function(d,e,f,g,h){var i,j,k,l=this,m={},n=!0;d.find=function(a){p(),E(),t(a).then(function(b){if(b.length>0){var c=b;j=q(c)||[],!d.displayAllUsers||a&&a.length||j.push({id:-1,isAll:!0}),k=j,G(k),d.reorderUsers(),B(k)&&C(k),x(k)&&(z(k),y(k).then(function(a){k=a},function(a){K("GET_HOMONYMS_PROPERTIES",a)}))}else d.users=[{overflow:"LUIDUSERPICKER_NORESULTS",id:-1}]},function(a){K("GET_USERS",a)})};var o,p=function(){r(),o&&o.then(function(a){})},q=function(a){var b=a;return l.useCustomFilter&&(b=_.filter(a,function(a){return d.customFilter(angular.copy(a))})),b},r=function(){m.count&&g.cancel(m.count)},s=function(){var c=b;return l.asyncPagination&&(c=a+1),c},t=function(a){var b="formerEmployees="+(d.showFormerEmployees?"true":"false"),c="&limit="+s(),f="clue="+a,g="",i="",j="/api/v3/users/find?"+(a?f+"&":"")+b+c,k=h.defer();return d.appId&&d.operations&&d.operations.length&&(i="&appinstanceid="+d.appId,g="&operations="+d.operations.join(",")),j+=i+g,o=e.get(j),o.then(function(a){k.resolve(a.data.data.items)},function(a){k.reject(a.data.Message)}),k.promise},u=function(b){return!!b&&b.length>a},v=function(b){l.asyncPagination?d.count="...":d.count=b.length,d.users=_.first(b,a),w()},w=function(){d.users.push({overflow:"LUIDUSERPICKER_OVERFLOW",cnt:a,all:d.count,id:-1})},x=function(a){var b=_.uniq(a,function(a){return a.firstName&&a.lastName?a.firstName.toLowerCase()+a.lastName.toLowerCase():void 0});return b.length<a.length},y=function(a){var b,e,f,g,i=_.where(a,{hasHomonyms:!0}),j=!1,k=h.defer();return d.displayedProperties=[],g=d.homonymsProperties&&d.homonymsProperties.length?d.homonymsProperties:c,A(i,g).then(function(c){_.each(i,function(a){var b=_.find(c,function(b){return a.id===b.id});_.each(g,function(c){var d=c.name.split(".")[0];a[d]=b[d]})}),_.each(g,function(a,h){if(!j){var k=_.rest(g,h+1);_.each(k,function(g,h){if(!j){b=[],_.each(c,function(c){var f=d.getProperty(c,a.name),h=d.getProperty(c,g.name);e={},e[a.name]=f,e[g.name]=h,b.push(e)});var k=_.chain(b).pluck(a.name).uniq().value(),l=_.chain(b).pluck(g.name).uniq().value();if(f||k.length!==i.length||(f=a),k.length>1&&l.length>1){var m=_.uniq(b,function(b){return b[a.name]+b[g.name]});m.length===b.length&&(j=!0,d.displayedProperties.push(a),d.displayedProperties.push(g))}}})}}),!j&&f&&d.displayedProperties.push(f),k.resolve(a)},function(a){k.reject(a)}),k.promise},z=function(a){_.each(a,function(b,c){if(b.firstName&&b.lastName){var d=_.rest(a,c+1);_.each(d,function(a){a.firstName&&a.lastName&&b.firstName.toLowerCase()===a.firstName.toLowerCase()&&b.lastName.toLowerCase()===a.lastName.toLowerCase()&&(b.hasHomonyms=!0,a.hasHomonyms=!0)})}})},A=function(a,b){var c="/api/v3/users?id=",d="&fields=id,firstname,lastname",f=h.defer();return _.each(b,function(a){d+=","+a.name}),_.each(a,function(b){c+=b!==_.last(a)?b.id+",":b.id+d}),e.get(c).then(function(a){f.resolve(a.data.data.items)},function(a){f.reject(a.data.Message)}),f.promise};d.getProperty=function(a,b){var c=b.split("."),d=a[_.first(c)];return _.each(c,function(a){d&&a!==_.first(c)&&(d=d[a])}),d};var B=function(a){var b=_.find(a,function(a){return f(a.dtContractEnd).isBefore(f())});return!!b},C=function(a){_.each(a,function(a){-1!==a.id&&f(a.dtContractEnd).isBefore(f())&&(a.isFormerEmployee=!0)})},D=function(){d.customInfo&&_.each(d.users,function(a){-1===a.id||a.info||(a.info=d.customInfo(angular.copy(a)))}),d.customInfoAsync&&_.each(d.users,function(a){-1===a.id||a.info||d.customInfoAsync(angular.copy(a)).then(function(b){a.info=b},function(a){K("GET_CUSTOM_INFO",a)})})},E=function(){n&&d.displayMeFirst&&(F().then(function(a){i=a},function(a){K("GET_ME",a)}),n=!1)},F=function(){var a="/api/v3/users/me?fields=id",b=h.defer();return e.get(a).then(function(a){b.resolve(a.data.data.id)},function(a){b.reject(a.data.Message)}),b.promise},G=function(a){return a&&0!==a.length?(void 0!==a[0].originalPosition?a=_.sortBy(a,"originalPosition"):_.each(a,function(a,b){a.originalPosition=b}),a):a},H=function(a){var b=a,c=l.isMultipleSelect?null:_.find(a,function(a){return a.id===l.getSelectedUserIds()[0]}),d=_.find(a,function(a){return a.id===i}),e=_.findWhere(a,{isAll:!0});return!d||c&&d.id===c.id||(d.isMe=!0,b=I(d,b)),e&&(b=I(e,b)),!c||e&&c.id===e.id||(c.isSelected=!0,b=I(c,b)),b},I=function(a,b){var c=b;if(b&&b.length){var d=_.partition(b,function(b){return b.id===a.id});return c=_.union(d[0],d[1]),c[0].isDisplayedFirst=!0,c}},J=function(a){_.each(a,function(a){a.isDisplayedFirst=!1,
a.isSelected=!1,a.isMe=!1})};d.reorderUsers=function(){if(l.isMultipleSelect){var a=_.difference(_.pluck(k,"id"),l.getSelectedUserIds());j=_.filter(k,function(b){return _.contains(a,b.id)})}j=G(j),J(j),j=H(j),u(j)?v(j):(d.users=j,d.count=(d.users||[]).length),l.displayCustomInfo&&D()};var K=function(a,b){switch(a){case"GET_USERS":d.users=[],d.users.push({overflow:"LUIDUSERPICKER_ERR_GET_USERS",id:-1}),console.log({cause:a,message:b});break;case"GET_COUNT":case"GET_HOMONYMS_PROPERTIES":case"GET_CUSTOM_INFO":case"GET_ME":console.log({cause:a,message:b})}}}]).filter("luifHighlight",["$filter","$translate",function(a,b){return function(c,d,e,f){return(f?"<i>"+b.instant(f)+"</i> ":"")+a("highlight")(c,d)+(e?'<span class="lui label">'+e+"</span>":"")}}]),angular.module("lui.translates.userpicker").config(["$translateProvider",function(a){a.translations("en",{LUIDUSERPICKER_FORMEREMPLOYEE:"Left on {{dtContractEnd | luifMoment : 'LL'}}",LUIDUSERPICKER_NORESULTS:"No results",LUIDUSERPICKER_ERR_GET_USERS:"Error while loading users",LUIDUSERPICKER_OVERFLOW:"{{cnt}} displayed results of {{all}}",LUIDUSERPICKER_PLACEHOLDER:"Type a last name or first name...",LUIDUSERPICKER_DEPARTMENT:"Department",LUIDUSERPICKER_LEGALENTITY:"Legal entity",LUIDUSERPICKER_EMPLOYEENUMBER:"Employee number",LUIDUSERPICKER_MAIL:"Email",LUIDUSERPICKER_SELECTED:"Selected:",LUIDUSERPICKER_ME:"Me:",LUIDUSERPICKER_ALL:"All users"}),a.translations("de",{LUIDUSERPICKER_FORMEREMPLOYEE:"Verließ die {{dtContractEnd | luifMoment : 'LL'}}",LUIDUSERPICKER_NORESULTS:"Keine Ergebnisse",LUIDUSERPICKER_ERR_GET_USERS:"Fehler",LUIDUSERPICKER_OVERFLOW:"Es werden {{cnt}} auf {{all}} Benutzernamen",LUIDUSERPICKER_PLACEHOLDER:"Geben Sie einen Benutzernamen...",LUIDUSERPICKER_DEPARTMENT:"Abteilung",LUIDUSERPICKER_LEGALENTITY:"Rechtsträger",LUIDUSERPICKER_EMPLOYEENUMBER:"Betriebsnummer",LUIDUSERPICKER_MAIL:"E-mail",LUIDUSERPICKER_SELECTED:"Ausgewählt:",LUIDUSERPICKER_ME:"Mir:",LUIDUSERPICKER_ALL:"Alle Benutzer"}),a.translations("es",{}),a.translations("fr",{LUIDUSERPICKER_FORMEREMPLOYEE:"Parti(e) le {{dtContractEnd | luifMoment : 'LL'}}",LUIDUSERPICKER_NORESULTS:"Aucun résultat",LUIDUSERPICKER_ERR_GET_USERS:"Erreur lors de la récupération des utilisateurs",LUIDUSERPICKER_OVERFLOW:"{{cnt}} résultats affichés sur {{all}}",LUIDUSERPICKER_PLACEHOLDER:"Saisissez un nom, prénom...",LUIDUSERPICKER_DEPARTMENT:"Service",LUIDUSERPICKER_LEGALENTITY:"Entité légale",LUIDUSERPICKER_EMPLOYEENUMBER:"Matricule",LUIDUSERPICKER_MAIL:"Email",LUIDUSERPICKER_SELECTED:"Sélectionné :",LUIDUSERPICKER_ME:"Moi :",LUIDUSERPICKER_ALL:"Tous les utilisateurs"}),a.translations("it",{}),a.translations("nl",{})}])}(),function(){"use strict";function a(a,b,c){function d(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}return a?a.replace(new RegExp(d(b),"g"),c):""}angular.module("lui.filters").filter("luifPlaceholder",function(){return function(a,b){return a?a:b}}).filter("luifDefaultCode",function(){return function(b){return a(b," ","_").toUpperCase()}}).filter("luifStartFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("luifNumber",["$sce","$filter",function(a,b){return function(c,d,e){function f(a,b){return void 0===a?'<span style="opacity:0"></span>':0===parseInt(a)?'<span style="opacity:0">'+b+a+"</span>":"<span>"+b+a+"</span>"}var g=void 0===e?"":e,h=void 0===c||null===c||""===c||c!=c?g:c,i=b("number")(1.1,1)[1],j=void 0===d||null===d||d!=d?2:d,k=b("number")(h,j),l=(k||b("number")(0,j)).split(i)[1],m=f(l,i);if(""===h||!k)return a.trustAsHtml(h+m);var n=k.split(i)[0];return a.trustAsHtml(n+m)}}])}(),function(){"use strict";var a=function(a,b){var c=moment(a);return c.isValid()?c.format(b):a};angular.module("lui.filters").filter("luifFriendlyRange",function(){var a={en:{sameDay:"start(dddd, LL)",sameDayThisYear:"start(dddd, MMMM Do)",sameMonth:"start(MMMM Do) - end(Do, YYYY)",sameMonthThisYear:"start(MMMM Do) - end(Do)",sameYear:"start(MMMM Do) - end(LL)",sameYearThisYear:"start(MMMM Do) - end(MMMM Do)",other:"start(LL) - end(LL)"},fr:{sameDay:"le start(dddd LL)",sameDayThisYear:"le start(dddd Do MMMM)",sameMonth:"du start(Do) au end(LL)",sameMonthThisYear:"du start(Do) au end(Do MMMM)",sameYear:"du start(Do MMMM) au end(LL)",sameYearThisYear:"du start(Do MMMM) au end(Do MMMM)",other:"du start(LL) au end(LL)"},de:{sameDay:"der start(dddd LL)",sameDayThisYear:"der start(dddd Do MMMM)",sameMonth:"von start(Do) bis end(LL)",sameMonthThisYear:"von start(Do) bis end(Do MMMM)",sameYear:"von start(Do MMMM) bis end(LL)",sameYearThisYear:"von start(Do MMMM) bis end(Do MMMM)",other:"von start(LL) bis end(LL)"}};return function(b,c,d,e){if(b){var f=moment(b.startsAt||b.startsOn||b.startDate||b.start),g=moment(b.endsAt||b.endsOn||b.endDate||b.end);c&&g.add(-1,"minutes");var h=a[moment.locale()]||a.en,i=f.year()===g.year()?f.month()===g.month()?f.date()===g.date()?"sameDay":"sameMonth":"sameYear":"other";moment().year()===f.year()&&moment().year()===g.year()&&(i+="ThisYear");var j=/(start\((.*?)\))(.*(end\((.*?)\))){0,1}/gi.exec(h[i]);return h[i].replace(j[1],f.format(j[2])).replace(j[4],g.format(j[5]))}}}).filter("luifMoment",function(){return function(b,c){return c||(c="LLL"),a(b,c)}}).filter("luifCalendar",function(){return function(a,b){var c=moment(a);b&&moment(b).isValid()?moment(b):moment();return c.isValid()?c.calendar(b):a}}).filter("luifDuration",["$filter",function(a){return function(b,c,d,e){function f(a){switch(a){case"d":case"day":case"days":return 0;case void 0:case"":case"h":case"hour":case"hours":return 1;case"m":case"min":case"mins":case"minute":case"minutes":return 2;case"s":case"sec":case"second":case"seconds":return 3;case"ms":case"millisec":case"millisecond":case"milliseconds":return 4}}function g(a,b){return 4===b?4:0!==a[b]?b:g(a,b+1)}function h(a,b){return 0===b?0:0!==a[b]?b:h(a,b-1)}function i(a){switch(!0){case 0===Math.floor(10*a%10)&&0===Math.floor(100*a%10):return 0;case 0===Math.floor(100*a%10):return 1;default:return 2}}function j(a,b,c){switch(b){case c:return a;case 2:case 3:return 10>a?"0"+a:a;case 4:return 10>a?"00"+a:100>a?"0"+a:a;default:return a}}function k(a,b){if(a){if(b.asMilliseconds()>0)return"+";if(b.asMilliseconds()<0)return"-"}return""}function l(a,b){var c=["d ","h","m","s","ms"];switch(moment.locale()){case"fr":c[0]="j "}return 3>=a&&4===b&&(c[3]=".",c[4]="s"),1>=a&&2===b&&(c[2]=""),2===a&&3===b&&(c[3]=""),c}var m=[{index:0,unit:"d",dateConversion:"asDays",expectedPrecision:"h"},{index:1,unit:"h",dateConversion:"asHours",expectedPrecision:"m"},{index:2,unit:"m",dateConversion:"asMinutes",expectedPrecision:"s"},{index:3,unit:"s",dateConversion:"asSeconds",expectedPrecision:"s"},{index:4,unit:"ms",dateConversion:"asMilliseconds",expectedPrecision:"ms"}],n=moment.duration(b);if(0===n.asMilliseconds())return"";var o=[Math.abs(n.days()),Math.abs(n.hours()),Math.abs(n.minutes()),Math.abs(n.seconds()),Math.abs(n.milliseconds())],p=m[f(d)],q=Math.max(p.index,g(o,0));if(o[p.index]=Math.abs(n[p.dateConversion]()>=0?Math.floor(n[p.dateConversion]()):Math.ceil(n[p.dateConversion]())),0===p.index&&0===f(e)&&n.asDays()>0){var r=n.asDays(),s=i(r);q=0,o[0]=a("number")(r,s)}for(var t=h(o,f(e||p.expectedPrecision)),u=l(q,t),v="",w=q;t>=w;w++)v+=j(o[w],w,q)+u[w];var x=v?k(c,n):"";return x+v}}]).filter("luifHumanize",function(){return function(a,b){b=!!b;var c=moment.duration(a);return c.humanize(b)}})}();var Lui;!function(a){"use strict";var b=function(){function a(){}return a}();a.Period=b}(Lui||(Lui={}));var Lui;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(){function a(){}return a}();a.Tree=b;var c=function(){function a(){}return a}();a.Header=c;var d=function(){function a(){}return a}();a.BrowseResult=d}(b=a.TableGrid||(a.TableGrid={}))}(b=a.Directives||(a.Directives={}))}(Lui||(Lui={}));var Lui;!function(a){var b;!function(a){"use strict";var b=function(){function a(){}return a.NONE="none",a.TEXT="text",a.SELECT="select",a.MULTISELECT="multiselect",a}();a.FilterTypeEnum=b;var c=function(){function a(a,c,d){var e=0,f=function(a){return a.tree.children.length||a.subChildren++,a.tree.children.forEach(function(b){var c=f({depth:a.depth+1,tree:b,subChildren:0,subDepth:0});a.subChildren+=c.subChildren,a.subDepth=Math.max(a.subDepth,c.subDepth)}),a.tree.children.length?a.subDepth++:c.colDefinitions.push(a.tree.node),a.tree.node&&(a.tree.node.rowspan=e-a.depth-a.subDepth,a.tree.node.colspan=a.subChildren,a.tree.children.length||a.tree.node.filterType!==b.NONE||a.tree.node.rowspan++,c.headerRows[a.depth]?c.headerRows[a.depth].push(a.tree.node):c.headerRows[a.depth]=[a.tree.node]),a},g=function(a){var b=0;return a.children.forEach(function(a){b=Math.max(b,g(a))}),b+1},h=function(){c.filters=[],_.each(c.datas,function(a){_.each(c.colDefinitions,function(d,e){if(c.filters[e]||(c.filters[e]={header:d,selectValues:[],currentValues:[]}),d.filterType===b.SELECT||d.filterType===b.MULTISELECT){var f=d.getValue(a);d.getFilterValue&&(f=d.getFilterValue(a)),_.contains(c.filters[e].selectValues,f)||c.filters[e].selectValues.push(f)}})})},i=function(){c.FilterTypeEnum=b,c.headerRows=[],c.bodyRows=[],c.colDefinitions=[],c.allChecked={value:!1},e=g(c.header),f({depth:0,subChildren:0,subDepth:0,tree:c.header}),c.selected={orderBy:null,reverse:!1},h()};c.updateFilteredAndOrderedRows=function(){var a=_.chain(c.datas).filter(function(a){var b=!0;return c.filters.forEach(function(c){if(c.header&&c.currentValues[0]&&""!==c.currentValues[0]){var d=(c.header.getValue(a)+"").toLowerCase(),e=_.some(c.currentValues,function(a){return-1!==d.indexOf(a.toLowerCase())});e||(b=!1)}}),b});c.selected&&c.selected.orderBy&&(a=a.sortBy(function(a){var b=c.selected.orderBy.getValue(a);return null!=c.selected.orderBy.getOrderByValue&&(b=c.selected.orderBy.getOrderByValue(a)),b}));var b=a.value();c.filteredAndOrderedRows=c.selected.reverse?b.reverse():b,c.updateVirtualScroll()},c.updateOrderBy=function(a){a===c.selected.orderBy?c.selected.reverse?(c.selected.orderBy=null,c.selected.reverse=!1):c.selected.reverse=!0:(c.selected.orderBy=a,c.selected.reverse=!1),c.updateFilteredAndOrderedRows()},c.onMasterCheckBoxChange=function(){_.some(c.filteredAndOrderedRows,function(a){return!a.isChecked})?_.each(c.filteredAndOrderedRows,function(a){a.isChecked=!0}):_.each(c.filteredAndOrderedRows,function(a){a.isChecked=!1})},c.onCheckBoxChange=function(){_.some(c.filteredAndOrderedRows,function(a){return!a.isChecked})?c.allChecked.value=!1:c.allChecked.value=!0},c.getCheckboxState=function(){var a=_.where(c.filteredAndOrderedRows,{isChecked:!0}).length;return 0===a?"":a===c.filteredAndOrderedRows.length?"checked":a<c.filteredAndOrderedRows.length?"partial":""},c.clearSelect=function(a,b,d){d.stopPropagation(),a.selected=void 0,c.filters[b].currentValues[0]="",c.updateFilteredAndOrderedRows()},i()}return a.IID="luidTableGridController",a.$inject=["$filter","$scope","$translate"],a}();a.LuidTableGridController=c,angular.module("lui.directives").controller(c.IID,c)}(b=a.Directives||(a.Directives={}))}(Lui||(Lui={}));var Lui;!function(a){var b;!function(a){"use strict";var b=function(){function a(b){var c=this;this.controller="luidTableGridController",this.restrict="AE",this.scope={header:"=",height:"@",datas:"=*",selectable:"@"},this.templateUrl="lui/templates/table-grid/table-grid.html",this.link=function(b,d,e){var f,g=angular.element(d[0].querySelector(".lui.tablegrid"))[0],h=g.querySelectorAll("table"),i=g.querySelectorAll("thead"),j=g.querySelectorAll("tbody"),k=g.querySelector(".locked.columns"),l=k.querySelector(".holder"),m=g.querySelector(".scrollable.columns"),n=m.querySelector(".virtualscroll"),o=function(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c===d&&(d=b.clientWidth),document.body.removeChild(b),c-d},p=function(){for(var a=0,b=0,c=h[1].querySelectorAll("tr:first-child td.locked");b<c.length;b++){var d=c[b];a+=d.offsetWidth}return a+1},q=o(),r=e.height?e.height:a.defaultHeight,s=33,t=Math.round(r/s),u=3*t,v=0;b.visibleRows=[],b.canvasHeight=0;var w=function(){console.log("resize");var a=0;a=m.clientHeight<b.canvasHeight?g.clientWidth-q:g.clientWidth;for(var c=0;c<i.length;c++){var d=i[c];d.style.minWidth=a+"px"}for(var e=0;e<h.length;e++){var f=h[e];f.style.minWidth=i[0].offsetWidth+"px"}l.style.height=j[0].clientWidth>a?+r+i[0].offsetHeight-q+"px":+r+i[0].offsetHeight+"px";var o=p();k.style.width=o+"px",m.style.marginLeft=o+"px",n.style.marginLeft=-o+"px",b.resizedHeaders()};b.resizedHeaders=function(){g.style.paddingTop=i[0].offsetHeight+"px"};var x=function(a){v=m.scrollTop,b.updateVirtualScroll(),b.$apply()};b.updateVirtualScroll=function(){console.log("update vs");var a=Math.max(Math.floor(v/s)-t,0),c=Math.min(a+u,u);b.visibleRows=b.filteredAndOrderedRows.slice(a,a+c),h[0].style.marginTop=i[0].offsetHeight+a*s+"px",h[1].style.marginTop=a*s+"px",b.canvasHeight=(b.filteredAndOrderedRows.length-a)*s},b.$watchCollection("datas",function(){b.datas&&(b.filteredAndOrderedRows=b.datas,c.$timeout(function(){b.updateFilteredAndOrderedRows(),w()},100))}),window.addEventListener("resize",function(){c.$timeout.cancel(f),f=c.$timeout(function(){w()},100)}),m.addEventListener("scroll",function(a){l.scrollTop=m.scrollTop,i[1].style.left=-m.scrollLeft+"px",x(a)});var y=function(){b.filteredAndOrderedRows=b.datas,t=Math.round(r/s),u=3*t,c.$timeout(function(){w(),b.updateVirtualScroll()},100)};y()},this.$timeout=b}return a.Factory=function(){var b=function(b){return new a(b)};return b.$inject=["$timeout"],b},a.defaultHeight=20,a.IID="luidTableGrid",a}();a.LuidTableGrid=b,angular.module("lui.directives").directive(b.IID,b.Factory())}(b=a.Directives||(a.Directives={}))}(Lui||(Lui={}));var Lui;!function(a){var b;!function(a){"use strict"}(b=a.Directives||(a.Directives={}))}(Lui||(Lui={})),angular.module("lui.directives").run(["$templateCache",function(a){"use strict";a.put("lui/templates/table-grid/table-grid.html",'<div class="lui tablegrid"><div class="locked columns"><div class=holder style="height: 500px"><div class=virtualscroll ng-style="{\'height\': canvasHeight + \'px\'}"><table><thead><tr role=row ng-repeat="row in headerRows track by $index" ng-if="$index !== 0"><th ng-if=selectable style="width: 3.5em" class=locked role=columnheader colspan=1 rowspan=1></th><th role=columnheader class=sortable ng-repeat="header in row track by $index" ng-class="{\'locked\': header.fixed, \'desc\': (selected.orderBy === header && selected.reverse === false), \'asc\': (selected.orderBy === header && selected.reverse === true)}" ng-style="{\'max-width\': header.width + \'em\', \'min-width\': header.width + \'em\'}" rowspan="{{ header.rowspan }}" colspan="{{ header.colspan }}" ng-click=updateOrderBy(header)>{{ header.label }}</th></tr><tr role=row><th ng-if=selectable style="width: 3.5em" class=locked role=columnheader colspan=1 rowspan=1><div class="lui solo checkbox"><input type=checkbox ng-class=getCheckboxState() ng-model=allChecked.value ng-change=onMasterCheckBoxChange() ng-value="true"><label>&nbsp;</label></div></th><th role=columnheader ng-repeat="header in colDefinitions track by $index" ng-style="{\'max-width\': header.width + \'em\', \'min-width\': header.width + \'em\'}" ng-if="header.filterType != FilterTypeEnum.NONE" colspan=1 rowspan=1 class=filtering><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.TEXT"><input ng-change=updateFilteredAndOrderedRows() ng-model=filters[$index].currentValues[0] ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }"></div><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.MULTISELECT"><ui-select multiple class="lui nguibs-ui-select" ng-model=filters[$index].currentValues reset-search-input=false on-remove=updateFilteredAndOrderedRows() on-select=updateFilteredAndOrderedRows()><ui-select-match placeholder="{{ \'SELECT_ITEMS\' | translate }}">{{ $item }}</ui-select-match><ui-select-choices repeat="value in filters[$index].selectValues | filter: $select.search">{{ value }}</ui-select-choices></ui-select></div><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.SELECT"><ui-select class="lui nguibs-ui-select" ng-model=filters[$index].currentValues[0] reset-search-input=true on-select=updateFilteredAndOrderedRows()><ui-select-match allow-clear=true placeholder="{{ \'SELECT_ITEM\' | translate }}">{{ $select.selected }}</ui-select-match><ui-select-choices repeat="value in filters[$index].selectValues | filter: $select.search">{{ value }}</ui-select-choices></ui-select></div></th></tr></thead><tbody><tr role=row ng-repeat="row in visibleRows" ng-style=row.styles><td ng-if=selectable style="width: 3.5em" class=locked colspan=1 rowspan=1><div class="lui solo checkbox"><input type=checkbox ng-change=onCheckBoxChange() ng-model="row.isChecked"><label>&nbsp;</label></div></td><td role=cell ng-repeat="cell in colDefinitions track by $index" ng-style="{\'max-width\': cell.width + \'em\', \'min-width\': cell.width + \'em\'}" ng-bind-html=cell.getValue(row) ng-class="{\'locked\': cell.fixed, \'lui left aligned\': cell.textAlign == \'left\', \'lui right aligned\': cell.textAlign == \'right\', \'lui center aligned\': cell.textAlign == \'center\'}"></td></tr></tbody></table></div></div></div><div class="scrollable columns" style="height: 500px"><div class=virtualscroll ng-style="{\'height\': canvasHeight + \'px\'}"><table><thead><tr role=row ng-repeat="row in headerRows track by $index" ng-if="$index !== 0"><th ng-if=selectable style="width: 3.5em" class=locked role=columnheader colspan=1 rowspan=1></th><th role=columnheader class=sortable ng-repeat="header in row track by $index" ng-click=updateOrderBy(header) ng-class="{\'locked\': header.fixed, \'desc\': (selected.orderBy === header && selected.reverse === false), \'asc\': (selected.orderBy === header && selected.reverse === true)}" ng-style="{\'max-width\': header.width + \'em\', \'min-width\': header.width + \'em\'}" rowspan="{{ header.rowspan }}" colspan="{{ header.colspan }}">{{ header.label }}</th></tr><tr role=row><th ng-if=selectable style="width: 3.5em" class=locked role=columnheader colspan=1 rowspan=1><div class="lui solo checkbox"><input ng-class=getCheckboxState() type=checkbox ng-model=allChecked.value ng-change=onMasterCheckBoxChange() ng-value="true"><label>&nbsp;</label></div></th><th role=columnheader ng-repeat="header in colDefinitions track by $index" ng-style="{\'max-width\': header.width + \'em\', \'min-width\': header.width + \'em\'}" ng-if="header.filterType != FilterTypeEnum.NONE" colspan=1 rowspan=1 class=filtering><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.TEXT"><input ng-change=updateFilteredAndOrderedRows() ng-model=filters[$index].currentValues[0] ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }"></div><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.MULTISELECT"><ui-select multiple class="lui nguibs-ui-select" ng-model=filters[$index].currentValues reset-search-input=false on-remove=updateFilteredAndOrderedRows() on-select=updateFilteredAndOrderedRows()><ui-select-match placeholder="{{ \'SELECT_ITEMS\' | translate }}">{{ $item }}</ui-select-match><ui-select-choices repeat="value in filters[$index].selectValues | filter: $select.search">{{ value }}</ui-select-choices></ui-select></div><div class="lui fitting search input" ng-if="header.filterType === FilterTypeEnum.SELECT"><ui-select class="lui nguibs-ui-select" ng-model=filters[$index].currentValues[0] reset-search-input=true on-select=updateFilteredAndOrderedRows()><ui-select-match allow-clear=true placeholder="{{ \'SELECT_ITEM\' | translate }}">{{ $select.selected }}</ui-select-match><ui-select-choices repeat="value in filters[$index].selectValues | filter: $select.search">{{ value }}</ui-select-choices></ui-select></div></th></tr></thead><tbody><tr role=row ng-repeat="row in visibleRows" ng-style=row.styles><td ng-if=selectable style="width: 3.5em" class=locked colspan=1 rowspan=1><div class="lui solo checkbox"><input type=checkbox ng-change=onCheckBoxChange() ng-model="row.isChecked"><label>&nbsp;</label></div></td><td role=cell ng-repeat="cell in colDefinitions track by $index" ng-style="{\'max-width\': cell.width + \'em\', \'min-width\': cell.width + \'em\'}" ng-bind-html=cell.getValue(row) ng-class="{\'locked\': cell.fixed, \'lui left aligned\': cell.textAlign == \'left\', \'lui right aligned\': cell.textAlign == \'right\', \'lui center aligned\': cell.textAlign == \'center\'}"></td></tr></tbody></table></div></div></div>')}]);