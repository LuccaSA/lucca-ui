/*! lucca-ui 10-12-2015 */
!function(){"use strict";angular.module("moment",[]).factory("moment",function(){return window.moment}),angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("lui.directives",["moment","underscore","ui.select","ui.bootstrap"]),angular.module("lui.filters",["moment"]),angular.module("lui.services",[]),angular.module("lui.templates.momentpicker",[]),angular.module("lui.templates.daterangepicker",[]),angular.module("lui.templates",["lui.templates.momentpicker","lui.templates.daterangepicker"]),angular.module("lui.translates.userpicker",[]),angular.module("lui.translates.daterangepicker",[]),angular.module("lui.translates",["pascalprecht.translate","lui.translates.userpicker","lui.translates.daterangepicker"]),angular.module("lui",["lui.directives","lui.services","lui.filters","lui.templates","lui.translates"])}(),function(){"use strict";angular.module("lui.directives").directive("luidDaterange",["moment","$filter","$document","$timeout",function(a,b,c,d){function e(e,f,g,h){var i=h[1],j=h[0];e.internal={},e.hasPeriods=!!g.periods,i.$render=function(){if(!i.$viewValue)return e.internal.startsOn=void 0,e.internal.endsOn=void 0,void(e.internal.strFriendly=void 0);var a=l(i.$viewValue);e.internal.startsOn=a.startsOn,e.internal.endsOn=a.endsOn,e.internal.strFriendly=b("luifFriendlyRange")(e.internal)},e.$watch(function(a){return i.$viewValue[a.startProperty||"startsOn"]},function(){i.$render()}),e.$watch(function(a){return i.$viewValue[a.endProperty||"endsOn"]},function(){i.$render()}),j.updateValue=function(a,b){var c=i.$viewValue,d=k(a,b);c[Object.keys(d)[0]]=d[Object.keys(d)[0]],c[Object.keys(d)[1]]=d[Object.keys(d)[1]],i.$setViewValue(c),e.$parent.$eval(g.ngChange)};var k=function(b,c){var d=a(b),f=a(c);e.excludeEnd&&f.add(1,"d");var g=e.startProperty||"startsOn",h=e.endProperty||"endsOn",i={};switch(e.format||"moment"){case"moment":i[g]=d,i[h]=f;break;case"date":i[g]=d.toDate(),i[h]=f.toDate();break;default:i[g]=d.format(e.format),i[h]=f.format(e.format)}return i},l=function(b){var c,d,f=e.startProperty||"startsOn",g=e.endProperty||"endsOn";switch(e.format||"moment"){case"moment":case"date":c=a(b[f]),d=a(b[g]);break;default:c=a(b[f],e.format),d=a(b[g],e.format)}e.excludeEnd&&d.add(-1,"d");var h={startsOn:c.toDate(),endsOn:d.toDate()};return h},m=function(){e.popoverOpened=!1,j.unpinPopover(),e.$apply()};j.pinPopover=function(){d(function(){c.on("click",m)},10)},j.unpinPopover=function(){c.off("click",m)}}return{require:["luidDaterange","^ngModel"],controller:"luidDaterangeController",scope:{disabled:"=",format:"@",startProperty:"@",endProperty:"@",popoverPlacement:"@",excludeEnd:"=",periods:"=",closeLabel:"@",closeAction:"&"},templateUrl:"lui/directives/luidDaterange.html",restrict:"EA",link:e}}]).controller("luidDaterangeController",["$scope","moment","$filter",function(a,b,c){var d=this;a.internalUpdated=function(){b(a.internal.startsOn).diff(a.internal.endsOn)>0&&(a.internal.endsOn=b(a.internal.startsOn)),a.hackRefresh=!a.hackRefresh,d.updateValue(a.internal.startsOn,a.internal.endsOn),a.internal.strFriendly=c("luifFriendlyRange")(a.internal)},a.goToPeriod=function(c){a.internal.startsOn=b(c.startsOn).toDate(),a.internal.endsOn=b(c.endsOn).toDate(),a.excludeEnd&&(a.internal.endsOn=b(c.endsOn).add(-1,"day").toDate()),a.internalUpdated()},a.popoverOpened=!1,a.togglePopover=function(){a.popoverOpened=!a.popoverOpened,a.popoverOpened?d.pinPopover():d.unpinPopover()},a.doCloseAction=function(){a.togglePopover(),a.closeAction&&a.closeAction()},a.clickInside=function(a){a.preventDefault(),a.stopPropagation()},a.dayClass=function(c,d){var e="";return"day"===d&&0===b(c).diff(a.internal.startsOn)&&(e="start"),"day"===d&&0===b(c).diff(a.internal.endsOn)&&(e+="end"),"day"===d&&b(c).isAfter(a.internal.startsOn)&&b(c).isBefore(a.internal.endsOn)&&(e+="in-between"),e}}]),angular.module("lui.templates.daterangepicker").run(["$templateCache",function(a){a.put("lui/directives/luidDaterange.html","<input ng-model='internal.strFriendly' ng-disabled='disabled || popoverOpen' ng-click='togglePopover()'uib-popover-template=\"'lui/directives/luidDaterangePopover.html'\"popover-placement=\"{{popoverPlacement}}\"popover-trigger ='none' popover-is-open='popoverOpened'popover-class ='lui daterange popover {{hasPeriods?\"has-periods\":\"\"}}'>"),a.put("lui/directives/luidDaterangePopover.html",'<div class="lui clear" ng-click="clickInside($event)">	<div class="lui vertical pills shortcuts menu">'+"		<a class='lui item' ng-repeat='period in periods' ng-click='goToPeriod(period)'>{{period.label}}</a>	</div>	<uib-datepicker ng-if='hackRefresh' class='lui datepicker' ng-model='internal.startsOn' show-weeks='false' custom-class='dayClass(date, mode)' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='hackRefresh' class='lui datepicker' ng-model='internal.endsOn' show-weeks='false' min-date='internal.startsOn' custom-class='dayClass(date, mode)' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='!hackRefresh' class='lui datepicker' ng-model='internal.startsOn' show-weeks='false' custom-class='dayClass(date, mode)' ng-change='internalUpdated()'></uib-datepicker>	<uib-datepicker ng-if='!hackRefresh' class='lui datepicker' ng-model='internal.endsOn' show-weeks='false' min-date='internal.startsOn' custom-class='dayClass(date, mode)' ng-change='internalUpdated()'></uib-datepicker>	<hr>	<a class='lui right pulled primary button' ng-click='doCloseAction()'>{{closeLabel || 'Ok'}}</a></div>")}])}(),function(){"use strict";angular.module("lui.directives").directive("luidKeydown",function(){return{restrict:"A",scope:{mappings:"="},link:function(a,b,c){b.on("keydown",function(b){a.mappings&&a.mappings[b.which]&&(a.mappings[b.which](),b.preventDefault())})}}}),angular.module("lui.directives").directive("luidSelectOnClick",function(){return{restrict:"A",link:function(a,b,c){b.on("click",function(){this.select()}),b.on("focus",function(){this.select()})}}}),angular.module("lui.directives").directive("luidFocusOn",function(){return function(a,b,c){a.$on(c.luidFocusOn,function(a){b[0].focus()})}})}(),function(){"use strict";angular.module("lui.directives").directive("luidSelect",[function(){return{require:"^ngModel",scope:{options:"=",placeholder:"@",displayProp:"@",ngDisabled:"=",classes:"@",onSelect:"&",onRemove:"&"},restrict:"E",template:'<ui-select theme="bootstrap" on-select="onSelect()" on-remove="onRemove()" class="lui nguibs-ui-select {{classes}}" ng-disabled="ngDisabled">	<ui-select-match placeholder="{{placeholder}}">{{$select.selected[displayProp]}}</ui-select-match>	<ui-select-choices repeat="option in options | filter: $select.search">		<div ng-bind-html="option[displayProp] | highlight: $select.search"></div>	</ui-select-choices></ui-select>'}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidMoment",["moment",function(a){function b(b,c,d,e){var f=e[1],g=e[0];if(b.hasButtons=void 0!==d.showButtons,d.format){var h=b.$eval(d.format);f.$render=function(){if(this.$viewValue&&a(this.$viewValue,h).isValid()){var c=a(this.$viewValue,h);b.hours=c.format("HH"),b.mins=c.format("mm")}else b.hours=void 0,b.mins=void 0},f.setValue=function(a){a?f.$setViewValue(a.format(h)):f.$setViewValue(void 0)}}else f.$render=function(){this.$viewValue&&this.$viewValue.isValid&&this.$viewValue.isValid()?(b.hours=this.$viewValue.format("HH"),b.mins=this.$viewValue.format("mm")):(b.hours=void 0,b.mins=void 0)},f.setValue=function(a){f.$setViewValue(a)};b.ngModelCtrl=f,f.$validators.min=function(a,b){return g.checkMin(a)},f.$validators.max=function(a,b){return g.checkMax(a)};var i=c.find("input"),j=angular.element(i[0]),k=angular.element(i[1]);g.setupEvents(j,k)}return{require:["luidMoment","^ngModel"],controller:"luidMomentController",scope:{min:"=",max:"=",step:"=",referenceDate:"=",disabled:"=",showButtons:"=",enforceValid:"=",format:"=",minOffset:"=",maxOffset:"="},templateUrl:"lui/directives/luidMoment.html",restrict:"EA",link:b}}]).controller("luidMomentController",["$scope","$timeout","moment",function(a,b,c){a.pattern=/^([0-9]{0,2})?$/;var d=[5,10,15,20,30],e=this,f=function(a,b){var c=!1;return angular.forEach(a,function(a){c=c||a===b}),c},g=function(b){if(!a.disabled){j(),a.ngModelCtrl.$setValidity("pattern",!0);var g=c(t());g&&g.isValid()||(g=q().startOf("day")),f(d,Math.abs(b))&&g.minutes()%b!==0&&(b=0>b?-(g.minutes()%b):-g.minutes()%b+b);var i=g.add(b,"m");e.checkMin(i)?e.checkMax(i)||(a.maxed=!0,i=s()):(a.mined=!0,i=r()),i.seconds(0),h(i)}},h=function(b){a.ngModelCtrl.setValue(b),a.ngModelCtrl.$render()},i=function(b){j(b),a.ngModelCtrl.setValue(b)},j=function(b){a.maxed=!1,a.mined=!1,b&&(r()&&0===r().diff(b)?a.mined=!0:s()&&0===s().diff(b)&&(a.maxed=!0))};a.changeHours=function(){return void 0===a.hours?(a.ngModelCtrl.$setValidity("pattern",!1),h(void 0)):(a.ngModelCtrl.$setValidity("pattern",!0),""===a.hours?h(void 0):(2==a.hours.length?(parseInt(a.hours)>23&&(a.hours="23"),a.$broadcast("focusMinutes")):1==a.hours.length&&parseInt(a.hours)>2&&(a.hours=0+a.hours,a.$broadcast("focusMinutes")),void i(k())))},a.changeMins=function(){return void 0===a.mins?(a.ngModelCtrl.$setValidity("pattern",!1),h(void 0)):(a.ngModelCtrl.$setValidity("pattern",!0),void i(k()))};var k=function(){var b=parseInt(a.hours),c=parseInt(a.mins);return b!=b&&(b=0),c!=c&&(c=0),c>60&&(c=59,a.mins="59"),q().hours(b).minutes(c).seconds(0)};a.formatInputValue=function(){a.ngModelCtrl.$render()},a.getDayGap=function(){var a=q().startOf("day");return c.duration(c(t()).startOf("d").diff(a)).asDays()},a.incrHours=function(){n(),g(60),a.$broadcast("focusHours")},a.decrHours=function(){n(),g(-60),a.$broadcast("focusHours")},a.incrMins=function(){n(),a.$broadcast("focusMinutes"),g(p())},a.decrMins=function(){n(),a.$broadcast("focusMinutes"),g(-p())};var l,m;a.blurHours=function(){l=b(function(){a.hoursFocused=!1,o()},200)},a.blurMins=function(){m=b(function(){a.minsFocused=!1,o()},200)},a.focusHours=function(){n(),a.minsFocused=!1,a.hoursFocused=!0},a.focusMins=function(){n(),a.minsFocused=!0,a.hoursFocused=!1};var n=function(){l&&(b.cancel(l),l=void 0),m&&(b.cancel(m),m=void 0)},o=function(){a.enforceValid&&(a.ngModelCtrl.$setValidity("pattern",!0),a.ngModelCtrl.$error.min?h(r()):a.ngModelCtrl.$error.max&&h(s()))},p=function(){var b=5;return isNaN(parseInt(a.step))||(b=parseInt(a.step)),b},q=function(){var b=c();return a.referenceDate&&c(a.referenceDate).isValid()?b=c(a.referenceDate):a.min&&c(a.min).isValid()?b=c(a.min):a.max&&c(a.max).isValid()&&(b=c(a.max)),b},r=function(){var b,d;if(!a.min)return void 0;if(a.min.isValid&&a.min.isValid())b=c(a.min);else if(c(a.min,"YYYY-MM-DD HH:mm").isValid())b=c(a.min,"YYYY-MM-DD HH:mm");else if(c(a.min,"HH:mm").isValid()){var e=q();b=c(a.min,"HH:mm").year(e.year()).month(e.month()).date(e.date())}return d=c.duration(a.minOffset),b.add(d),b},s=function(){var b,d;if(!a.max)return void 0;if(a.max.isValid&&a.max.isValid())b=c(a.max);else if(c(a.max,"YYYY-MM-DD HH:mm").isValid())b=c(a.max,"YYYY-MM-DD HH:mm");else if(c(a.max,"HH:mm").isValid()){var e=q();b=c(a.max,"HH:mm").year(e.year()).month(e.month()).date(e.date()),b.hours()+b.minutes()===0&&b.add(1,"d")}return d=c.duration(a.maxOffset),b.add(d),b},t=function(){return a.format?c(a.ngModelCtrl.$viewValue,a.format):a.ngModelCtrl.$viewValue};this.checkMin=function(a){var b=r();return!b||b.diff(a)<=0},this.checkMax=function(a){var b=s();return!b||b.diff(a)>=0},this.setupEvents=function(a,b){u(a,b),v(a,b)};var u=function(b,c){var d=p();b.bind("keydown",function(b){38===b.which?(b.preventDefault(),g(60),a.$apply()):40===b.which?(b.preventDefault(),g(-60),a.$apply()):13===b.which&&(b.preventDefault(),a.formatInputValue(),a.$apply())}),c.bind("keydown",function(b){38===b.which?(b.preventDefault(),g(d),a.$apply()):40===b.which?(b.preventDefault(),g(-d),a.$apply()):13===b.which&&(b.preventDefault(),a.formatInputValue(),a.$apply())})},v=function(b,c){var d=p(),e=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};b.bind("mousewheel wheel",function(b){a.disabled||(a.$apply(g(e(b)?60:-60)),b.preventDefault())}),c.bind("mousewheel wheel",function(b){a.disabled||(a.$apply(g(e(b)?d:-d)),b.preventDefault())})}}]),angular.module("lui.templates.momentpicker").run(["$templateCache",function(a){a.put("lui/directives/luidMoment.html","<div class='luid-moment' ng-class='{disabled:disabled}'>	<input type='text' ng-model='hours' ng-change='changeHours()' luid-select-on-click ng-pattern='pattern' luid-focus-on='focusHours'   ng-focus='focusHours()' ng-blur='blurHours()' ng-disabled='disabled' maxlength=2> : 	<input type='text' ng-model='mins'  ng-change='changeMins()'  luid-select-on-click ng-pattern='pattern' luid-focus-on='focusMinutes' ng-focus='focusMins()'  ng-blur='blurMins()'  ng-disabled='disabled' maxlength=2>	<i ng-if='hasButtons' ng-click='incrHours()' ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button top left north arrow icon'     ng-class='{disabled:maxed}'></i>	<i ng-if='hasButtons' ng-click='decrHours()' ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button bottom left south arrow icon'  ng-class='{disabled:mined}'></i>	<i ng-if='hasButtons' ng-click='incrMins()'  ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button top right north arrow icon'    ng-class='{disabled:maxed}'></i>	<i ng-if='hasButtons' ng-click='decrMins()'  ng-show='showButtons||hoursFocused||minsFocused' class='lui mp-button bottom right south arrow icon' ng-class='{disabled:mined}'></i></div>")}])}(),function(){"use strict";angular.module("lui.directives").directive("luidPercentage",function(){function a(a,b,c,d){var e=d[1],f=d[0];if(a.pattern=/^([0-9]+)(\.([0-9]*)?)?$/i,c.format){if("0.XX"!==c.format&&"1.XX"!==c.format&&"XX"!==c.format)return void(e.$render=function(){a.intPct="unsupported format"})}else a.format="0.XX";a.ngModelCtrl=e,e.$render=function(){return void 0===this.$viewValue?void(a.intPct=void 0):void(a.intPct=a.parse(parseFloat(this.$viewValue)))},e.$viewChangeListeners.push(function(){a.$eval(c.ngChange)}),f.setupEvents(b.find("input"))}return{require:["luidPercentage","^ngModel"],controller:"luidPercentageController",scope:{step:"=",format:"@",ngDisabled:"=",placeholder:"@"},restrict:"EA",link:a,template:"<div class='lui short input with addon'><input class='lui right aligned' type='text' ng-disabled='ngDisabled' placeholder='{{placeholder}}' ng-model='intPct' ng-change='updateValue()' ng-blur='formatInputValue()'><i class='lui right addon'>%</i></div>"}}).controller("luidPercentageController",["$scope",function(a){a.updateValue=function(){if(void 0===a.intPct)return e(void 0);var c=b(a.intPct);e(c)};var b=function(b){switch(a.format||"0.XX"){case"XX":return b;case"0.XX":return b/100;case"1.XX":return b/100+1}return 0};a.parse=function(b){switch(a.format||"0.XX"){case"XX":return b;case"0.XX":return Math.round(1e4*b)/100;case"1.XX":return Math.round(1e4*(b-1))/100}return 0};var c=function(c){var e=b(parseFloat(a.intPct)+c);d(e)},d=function(b){a.ngModelCtrl.$setViewValue(b),a.ngModelCtrl.$render()},e=function(b){a.ngModelCtrl.$setViewValue(b)};a.formatInputValue=function(){a.ngModelCtrl.$render()},this.setupEvents=function(a){f(a),g(a)};var f=function(b){var d=5;isNaN(parseInt(a.step))||(d=parseInt(a.step)),b.bind("keydown",function(b){38===b.which?(b.preventDefault(),c(d),a.$apply()):40===b.which&&(b.preventDefault(),c(-d),a.$apply()),13===b.which&&(b.preventDefault(),a.formatInputValue(),a.$apply())})},g=function(b){var d=5;isNaN(parseInt(a.step))||(d=parseInt(a.step));var e=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};b.bind("mousewheel wheel",function(b){this===document.activeElement&&(a.$apply(c(e(b)?d:-d)),b.preventDefault())})}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidTimespan",["moment",function(a){function b(b,c,d,e){var f=e[1],g=e[0];if(b.pattern=/^([0-9]+)((h([0-9]{2})?)?(m(in)?)?)?$/i,d.unit){var h=b.$eval(d.unit);("h"==h||"hour"==h||"hours"==h)&&(b.useHours=!0)}b.ngModelCtrl=f,f.$render=function(){if(!this.$viewValue)return void(b.strDuration="");var c=a.duration(this.$viewValue),d=Math.floor(c.asHours()),e=c.minutes();0===d?b.strDuration=e+"m":b.strDuration=(10>d?"0":"")+d+"h"+(10>e?"0":"")+e},g.setupEvents(c.find("input")),g.mode=d.mode?d.mode:"timespan"}return{require:["luidTimespan","^ngModel"],controller:"luidTimespanController",scope:{step:"=",unit:"=",ngDisabled:"=",placeholder:"@",mode:"=",min:"=",max:"="},restrict:"EA",link:b,template:"<input type='text' ng-disabled='ngDisabled' placeholder='{{placeholder}}' ng-pattern='pattern' ng-model='strDuration' ng-change='updateValue()' ng-blur='formatInputValue()'>"}}]).controller("luidTimespanController",["$scope","moment",function(a,b){var c=this;a.updateValue=function(){if(!a.strDuration)return l(void 0);var b,c;b=e(a.strDuration),p(b)||(b=r()),q(b)||(b=s()),c=d(b),l(c)};var d=function(a){return"timespan"===c.mode?(a.days()>0?Math.floor(a.asDays())+".":"")+(a.hours()<10?"0":"")+a.hours()+":"+(a.minutes()<10?"0":"")+a.minutes()+":00":a},e=function(b){var c;return c=/h/i.test(b)?f(b):/m/i.test(b)?g(b):a.useHours?h(b):g(b)},f=function(a){var c=b.duration(),d=a.split(/h/i);c.add(parseInt(d[0]),"hours");var e=d[1];return e&&e.length>=2&&c.add(parseInt(e.substring(0,2)),"minutes"),c},g=function(a){var c=b.duration(),d=a.split(/m/i);return c.add(parseInt(d[0]),"minutes"),c},h=function(a){var c=b.duration(),d=a.split(/h/i);return c.add(parseInt(d[0]),"hours"),c},i=function(a){return"timespan"===c.mode?Math.floor(a.asDays())+"."+(a.hours()<10?"0":"")+a.hours()+":"+(a.minutes()<10?"0":"")+a.minutes()+":00":a},j=function(a){var c=b.duration(m()).add(a,"minutes");c.asMilliseconds()<0&&(c=b.duration()),p(c)||(c=r()),q(c)||(c=s());var d=i(c);k(d)},k=function(b){a.ngModelCtrl.$setViewValue(b),a.ngModelCtrl.$render()},l=function(b){a.ngModelCtrl.$setViewValue(b)};a.formatInputValue=function(){a.ngModelCtrl.$render()};var m=function(){return a.ngModelCtrl.$viewValue};this.setupEvents=function(a){n(a),o(a)};var n=function(b){var c=5;isNaN(parseInt(a.step))||(c=parseInt(a.step)),b.bind("keydown",function(b){38===b.which?(b.preventDefault(),j(c),a.$apply()):40===b.which&&(b.preventDefault(),j(-c),a.$apply()),13===b.which&&(b.preventDefault(),a.formatInputValue(),a.$apply())})},o=function(b){var c=5;isNaN(parseInt(a.step))||(c=parseInt(a.step));var d=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};b.bind("mousewheel wheel",function(b){this===document.activeElement&&(a.$apply(j(d(b)?c:-c)),b.preventDefault())})},p=function(a){var b=r();return!b||a>=b},q=function(a){var b=s();return!b||b>=a},r=function(){return a.min?b.duration(a.min):void 0},s=function(){return a.max?b.duration(a.max):void 0}}])}(),function(){"use strict";angular.module("lui.directives").directive("luidUserSelect",[function(){return{require:"^ngModel",scope:{users:"=",placeholder:"@",onSelect:"&",onRemove:"&"},restrict:"E",template:'<ui-select theme="bootstrap" on-select="onSelect()" on-remove="onRemove()">	<ui-select-match placeholder="{{placeholder}}">{{$select.selected.displayName}}</ui-select-match>	<ui-select-choices repeat="user in users | filter: $select.search">		<div ng-bind-html="user.displayName"></div>	</ui-select-choices></ui-select>'}}])}(),function(){"use strict";var a=5,b=1e4,c=[{label:"LUIDUSERPICKER_DEPARTMENT",name:"department.name",icon:"location"},{label:"LUIDUSERPICKER_LEGALENTITY",name:"legalEntity.name",icon:"tree list"},{label:"LUIDUSERPICKER_EMPLOYEENUMBER",name:"employeeNumber",icon:"user"},{label:"LUIDUSERPICKER_MAIL",name:"mail",icon:"email"}],d='<ui-select-choices position="down" repeat="user in users" refresh="find($select.search)" refresh-delay="0" ui-disable-choice="!!user.overflow"><div ng-class="{dividing: user.isDisplayedFirst}"><div ng-if="!!user.isSelected" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info : \'LUIDUSERPICKER_SELECTED\'"></div><div ng-if="!!user.isAll">{{ \'LUIDUSERPICKER_ALL\' | translate }}</div><div ng-if="!!user.isMe" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info : \'LUIDUSERPICKER_ME\'"></div><div ng-if="!user.isDisplayedFirst" ng-bind-html="user.firstName + \' \' + user.lastName | luifHighlight : $select.search : user.info"></div><small ng-if="!user.overflow && user.hasHomonyms && getProperty(user, property.name)" ng-repeat="property in displayedProperties"><i class="lui icon {{property.icon}}"></i> <b>{{property.label | translate}}</b> {{getProperty(user, property.name)}}<br/></small><small ng-if="showFormerEmployees && user.isFormerEmployee" translate translate-values="{dtContractEnd:user.dtContractEnd}">LUIDUSERPICKER_FORMEREMPLOYEE</small></div><small ng-if="user.overflow" translate translate-values="{cnt:user.cnt, all:user.all}">{{user.overflow}}</small></ui-select-choices>',e='<ui-select theme="bootstrap"class="lui regular nguibs-ui-select" on-select="onSelect()" on-remove="onRemove()" ng-disabled="controlDisabled"><ui-select-match placeholder="{{ \'LUIDUSERPICKER_PLACEHOLDER\' | translate }}"><div ng-if="!$select.selected.isAll">{{ $select.selected.firstName }} {{$select.selected.lastName}}</div><div ng-if="$select.selected.isAll">{{ \'LUIDUSERPICKER_ALL\' | translate }}</div></ui-select-match>'+d+"</ui-select>";angular.module("lui.directives").directive("luidUserPicker",function(){return{restrict:"E",controller:"luidUserPickerController",template:e,require:["luidUserPicker","^ngModel"],scope:{onSelect:"&",onRemove:"&",controlDisabled:"=",showFormerEmployees:"=",homonymsProperties:"=",customFilter:"=",appId:"=",operations:"=",customInfo:"=",customInfoAsync:"=",displayMeFirst:"=",displayAllUsers:"="},link:function(a,b,c,d){var e=d[0],f=d[1];e.isMultipleSelect=!1,e.asyncPagination=!1,e.useCustomFilter=!!c.customFilter,e.displayCustomInfo=!!c.customInfo||!!c.customInfoAsync,a.$watch(function(){return(f.$viewValue||{}).id},function(){a.reorderUsers()}),a.getSelectedUser=function(){return f.$viewValue},a.getSelectedUserId=function(){return f.$viewValue?f.$viewValue.id:void 0}}}}).controller("luidUserPickerController",["$scope","$http","moment","$timeout","$q",function(d,e,f,g,h){var i,j=this,k={},l=!0;d.selected={},d.selected.users=[];var m;d.find=function(a){o(),D(),s(a).then(function(b){if(b.length>0){var c=b;m=p(c)||[],!d.displayAllUsers||a&&a.length||m.push({id:-1,isAll:!0}),d.reorderUsers(),A(m)&&B(m),w(m)&&(y(m),x(m).then(function(a){m=a},function(a){J("GET_HOMONYMS_PROPERTIES",a)})),j.displayCustomInfo&&C()}else d.users=[{overflow:"LUIDUSERPICKER_NORESULTS",id:-1}]},function(a){J("GET_USERS",a)})};var n,o=function(){q(),n&&n.then(function(a){})},p=function(a){var b=a;return j.useCustomFilter&&(b=_.filter(a,function(a){return d.customFilter(angular.copy(a))})),b},q=function(){k.count&&g.cancel(k.count)},r=function(){var c=b;return j.asyncPagination&&(c=a+1),c},s=function(a){var b="formerEmployees="+(d.showFormerEmployees?"true":"false"),c="&limit="+r(),f="clue="+a,g="",i="",j="/api/v3/users/find?"+(a?f+"&":"")+b+c,k=h.defer();return d.appId&&d.operations&&d.operations.length&&(i="&appinstanceid="+d.appId,g="&operations="+d.operations.join(",")),j+=i+g,n=e.get(j),n.success(function(a){k.resolve(a.data.items)}).error(function(a){k.reject(a.Message)}),k.promise},t=function(b){return!!b&&b.length>a},u=function(b){j.asyncPagination?d.count="...":d.count=b.length,d.users=_.first(b,a),v()},v=function(){d.users.push({overflow:"LUIDUSERPICKER_OVERFLOW",cnt:a,all:d.count,id:-1})},w=function(a){var b=_.uniq(a,function(a){return a.firstName&&a.lastName?a.firstName.toLowerCase()+a.lastName.toLowerCase():void 0});return b.length<a.length?!0:!1},x=function(a){var b,e,f,g,i=_.where(a,{hasHomonyms:!0}),j=!1,k=h.defer();return d.displayedProperties=[],g=d.homonymsProperties&&d.homonymsProperties.length?d.homonymsProperties:c,z(i,g).then(function(c){_.each(i,function(a){var b=_.find(c,function(b){return a.id===b.id});_.each(g,function(c){var d=c.name.split(".")[0];a[d]=b[d]})}),_.each(g,function(a,h){if(!j){var k=_.rest(g,h+1);_.each(k,function(g,h){if(!j){b=[],_.each(c,function(c){var f=d.getProperty(c,a.name),h=d.getProperty(c,g.name);e={},e[a.name]=f,e[g.name]=h,b.push(e)});var k=_.chain(b).pluck(a.name).uniq().value(),l=_.chain(b).pluck(g.name).uniq().value();if(f||k.length!==i.length||(f=a),k.length>1&&l.length>1){var m=_.uniq(b,function(b){return b[a.name]+b[g.name]});m.length===b.length&&(j=!0,d.displayedProperties.push(a),d.displayedProperties.push(g))}}})}}),!j&&f&&d.displayedProperties.push(f),k.resolve(a)},function(a){k.reject(a)}),k.promise},y=function(a){_.each(a,function(b,c){if(b.firstName&&b.lastName){var d=_.rest(a,c+1);_.each(d,function(a){a.firstName&&a.lastName&&b.firstName.toLowerCase()===a.firstName.toLowerCase()&&b.lastName.toLowerCase()===a.lastName.toLowerCase()&&(b.hasHomonyms=!0,a.hasHomonyms=!0)})}})},z=function(a,b){var c="/api/v3/users?id=",d="&fields=id,firstname,lastname",f=h.defer();return _.each(b,function(a){d+=","+a.name}),_.each(a,function(b){c+=b!==_.last(a)?b.id+",":b.id+d}),e.get(c).then(function(a){var b=a.data.data.items;f.resolve(b)},function(a){f.reject(a)}),f.promise};d.getProperty=function(a,b){var c=b.split("."),d=a[_.first(c)];return _.each(c,function(a){d&&a!==_.first(c)&&(d=d[a])}),d};var A=function(a){var b=_.find(a,function(a){return f(a.dtContractEnd).isBefore(f())});return b?!0:!1},B=function(a){_.each(a,function(a){-1!==a.id&&f(a.dtContractEnd).isBefore(f())&&(a.isFormerEmployee=!0)})},C=function(){d.customInfo&&_.each(d.users,function(a){-1!==a.id&&(a.info=d.customInfo(angular.copy(a)))}),d.customInfoAsync&&_.each(d.users,function(a){-1!==a.id&&d.customInfoAsync(angular.copy(a)).then(function(b){a.info=b},function(a){J("GET_CUSTOM_INFO",a)})})},D=function(){l&&d.displayMeFirst&&(E().then(function(a){i=a},function(a){J("GET_ME",a)}),l=!1)},E=function(){var a="/api/v3/users/me?fields=id",b=h.defer();return e.get(a).success(function(a){b.resolve(a.data.id)}).error(function(a){b.reject(a.Message)}),b.promise},F=function(a){return a&&0!==a.length?(void 0!==a[0].originalPosition?a=_.sortBy(a,"originalPosition"):_.each(a,function(a,b){a.originalPosition=b}),a):a},G=function(a){var b=a,c=_.find(a,function(a){return a.id===d.getSelectedUserId()}),e=_.find(a,function(a){return a.id===i}),f=_.findWhere(a,{isAll:!0});return!e||c&&e.id===c.id||(e.isMe=!0,b=H(e,b)),f&&(b=H(f,b)),!c||f&&c.id===f.id||(c.isSelected=!0,b=H(c,b)),b},H=function(a,b){var c=b;if(b&&b.length){var d=_.partition(b,function(b){return b.id===a.id});return c=_.union(d[0],d[1]),c[0].isDisplayedFirst=!0,c}},I=function(a){_.each(a,function(a){a.isDisplayedFirst=!1,a.isSelected=!1,a.isMe=!1})};d.reorderUsers=function(){m=F(m),I(m),m=G(m),t(m)?u(m):(d.users=m,d.count=(d.users||[]).length)};var J=function(a,b){switch(a){case"GET_USERS":d.users=[],d.users.push({overflow:"LUIDUSERPICKER_ERR_GET_USERS",id:-1}),console.log({cause:a,message:b});break;case"GET_COUNT":case"GET_HOMONYMS_PROPERTIES":case"GET_CUSTOM_INFO":case"GET_ME":console.log({cause:a,message:b})}}}]).filter("luifHighlight",["$filter","$translate",function(a,b){return function(c,d,e,f){return(f?"<i>"+b.instant(f)+"</i> ":"")+a("highlight")(c,d)+(e?'<span class="lui label">'+e+"</span>":"")}}]),angular.module("lui.translates.userpicker").config(["$translateProvider",function(a){a.translations("en",{LUIDUSERPICKER_FORMEREMPLOYEE:"Left on {{dtContractEnd | luifMoment : 'LL'}}",LUIDUSERPICKER_NORESULTS:"No results",LUIDUSERPICKER_ERR_GET_USERS:"Error while loading users",LUIDUSERPICKER_OVERFLOW:"{{cnt}} displayed results of {{all}}",LUIDUSERPICKER_PLACEHOLDER:"Type a last name or first name...",LUIDUSERPICKER_DEPARTMENT:"Department",LUIDUSERPICKER_LEGALENTITY:"Legal entity",LUIDUSERPICKER_EMPLOYEENUMBER:"Employee number",LUIDUSERPICKER_MAIL:"Email",LUIDUSERPICKER_SELECTED:"Selected:",LUIDUSERPICKER_ME:"Me:",LUIDUSERPICKER_ALL:"All users"}),a.translations("de",{}),a.translations("es",{}),a.translations("fr",{LUIDUSERPICKER_FORMEREMPLOYEE:"Parti(e) le {{dtContractEnd | luifMoment : 'LL'}}",LUIDUSERPICKER_NORESULTS:"Aucun résultat",LUIDUSERPICKER_ERR_GET_USERS:"Erreur lors de la récupération des utilisateurs",LUIDUSERPICKER_OVERFLOW:"{{cnt}} résultats affichés sur {{all}}",LUIDUSERPICKER_PLACEHOLDER:"Saisissez un nom, prénom...",LUIDUSERPICKER_DEPARTMENT:"Service",LUIDUSERPICKER_LEGALENTITY:"Entité légale",LUIDUSERPICKER_EMPLOYEENUMBER:"Matricule",LUIDUSERPICKER_MAIL:"Email",LUIDUSERPICKER_SELECTED:"Sélectionné :",LUIDUSERPICKER_ME:"Moi :",LUIDUSERPICKER_ALL:"Tous les utilisateurs"}),a.translations("it",{}),a.translations("nl",{})}])}(),function(){"use strict";function a(a,b,c){function d(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}return a?a.replace(new RegExp(d(b),"g"),c):""}angular.module("lui.filters").filter("luifPlaceholder",function(){return function(a,b){return a?a:b}}).filter("luifDefaultCode",function(){return function(b){return a(b," ","_").toUpperCase()}}).filter("luifStartFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("luifNumber",["$sce","$filter",function(a,b){return function(c,d,e){var f,g=void 0===e?"":e,h=void 0===c||null===c||""===c||c!=c?g:c,i=b("number")(1.1,1)[1],j=void 0===d||null===d||d!=d?2:d,k=b("number")(h,j),l=(k||b("number")(0,j)).split(i)[1];if(f=void 0===l?'<span style="opacity:0"></span>':0===parseInt(l)?'<span style="opacity:0">'+i+l+"</span>":"<span>"+i+l+"</span>",""===h||!k)return a.trustAsHtml(h+f);var m=k.split(i)[0];return a.trustAsHtml(m+f)}}])}(),function(){"use strict";var a=function(a,b){var c=moment(a);return c.isValid()?c.format(b):a};angular.module("lui.filters").filter("luifFriendlyRange",function(){var a={en:{sameDay:"start(LL)",sameMonth:"start(MMMM Do) - end(Do, YYYY)",sameYear:"start(MMMM Do) - end(LL)",other:"start(LL) - end(LL)"},fr:{sameDay:"le start(LL)",sameMonth:"du start(Do) au end(LL)",sameYear:"du start(Do MMMM) au end(LL)",other:"du start(LL) au end(LL)"}},b={en:{sameDay:"start(MMMM Do)",sameMonth:"start(MMMM Do) - end(Do)",sameYear:"start(MMMM Do) - end(MMMM Do)",other:"start(LL) - end(LL)"},fr:{sameDay:"le start(Do MMMM)",sameMonth:"du start(Do) au end(Do MMMM)",sameYear:"du start(Do MMMM) au end(Do MMMM)",other:"du start(LL) au end(LL)"}};return function(c,d){if(c){var e=moment(c.startsAt||c.startsOn||c.startDate||c.start),f=moment(c.endsAt||c.endsOn||c.endDate||c.end);d&&f.add(-1,"d");var g=a[moment.locale()]||a.en;moment().year()===e.year()&&moment().year()===f.year()&&(g=b[moment.locale()]||b.en);var h=e.year()===f.year()?e.month()===f.month()?e.date()===f.date()?"sameDay":"sameMonth":"sameYear":"other",i=/(start\((.*?)\))(.*(end\((.*?)\))){0,1}/gi.exec(g[h]);return g[h].replace(i[1],e.format(i[2])).replace(i[4],f.format(i[5]))}}}).filter("luifMoment",function(){return function(b,c){return c||(c="LLL"),a(b,c)}}).filter("luifCalendar",function(){return function(a,b){var c=moment(a);b&&moment(b).isValid()?moment(b):moment();return c.isValid()?c.calendar(b):a}}).filter("luifDuration",function(){return function(a,b,c,d){var e=moment.duration(a);if(0===e.asMilliseconds())return"";var f,g=[Math.abs(e.days()),Math.abs(e.hours()),Math.abs(e.minutes()),Math.abs(e.seconds()),Math.abs(e.milliseconds())],h=["d ","h","m","s","ms"];switch(c){case"d":case"day":case"days":d=d?d:"h",f=0!==g[0]?0:0!==g[1]?1:0!==g[2]?2:0!==g[3]?3:4,g[0]=Math.abs(e.asDays()>=0?Math.floor(e.asDays()):Math.ceil(e.asDays()));break;case void 0:case"":case"h":case"hour":case"hours":d=d||"m",f=0!==g[0]||0!==g[1]?1:0!==g[2]?2:0!==g[3]?3:4,g[1]=Math.abs(e.asHours()>=0?Math.floor(e.asHours()):Math.ceil(e.asHours()));break;case"m":case"min":case"mins":case"minute":case"minutes":d=d||"s",f=0!==g[0]||0!==g[1]||0!==g[2]?2:0!==g[3]?3:4,g[2]=Math.abs(e.asMinutes()>=0?Math.floor(e.asMinutes()):Math.ceil(e.asMinutes()));
break;case"s":case"sec":case"second":case"seconds":d=d||"s",f=0!==g[0]||0!==g[1]||0!==g[2]||0!==g[3]?3:4,g[3]=Math.abs(e.asSeconds()>=0?Math.floor(e.asSeconds()):Math.ceil(e.asSeconds()));break;case"ms":case"millisec":case"millisecond":case"milliseconds":d=d||"ms",f=4,g[4]=Math.abs(e.asMilliseconds()>=0?Math.floor(e.asMilliseconds()):Math.ceil(e.asMilliseconds()))}var i;switch(d){case"d":case"day":case"days":i=0;break;case"h":case"hour":case"hours":i=0!==g[1]?1:0;break;case"m":case"min":case"mins":case"minute":case"minutes":i=0!==g[2]?2:0!==g[1]?1:0;break;case"s":case"sec":case"second":case"seconds":i=0!==g[3]?3:0!==g[2]?2:0!==g[1]?1:0;break;case"ms":case"millisec":case"millisecond":case"milliseconds":i=0!==g[4]?4:0!==g[3]?3:0!==g[2]?2:0!==g[1]?1:0}switch(moment.locale()){case"fr":h[0]="j "}3>=f&&4===i&&(h[3]=".",h[4]="s"),1>=f&&2===i&&(h[2]=""),2===f&&3===i&&(h[3]="");for(var j=function(a,b){return b===f?a+h[b]:2===b||3===b?(10>a?"0"+a:a)+h[b]:4===b?(10>a?"00"+a:100>a?"0"+a:a)+h[b]:a+h[b]},k="",l=f;i>=l;l++)k+=j(g[l],l);var m="";return b&&k&&(e.asMilliseconds()>0?m="+":e.asMilliseconds()<0&&(m="-")),m+k}}).filter("luifHumanize",function(){return function(a,b){b=!!b;var c=moment.duration(a);return c.humanize(b)}})}();