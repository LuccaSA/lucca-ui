<div id="main-content">
	<nav id="toc" class="lui left stuck vertical primary dividing menu">
		<a class="item" href="#/lucca#luid-user-picker">luid-user-picker</a>
	</nav>

	<section class="lui typeset container">
		<div class="lui callout primary">
			<p>
				<b>Important:</b>
				The js part of lucca-ui is an angular framework so is obviously dependent on <code>angular</code>.
				It also uses <code>momentjs</code> for its manipulation of dates cuz <a class="lui fancy link" href="http://momentjs.com/">momentjs</a> is super awesome.
				It also uses <code>underscorejs</code>, which is a Javascript library providing very usefull helpers (especially for arrays and collections). <br />
				The luid-user-picker directive depends on <code>AngularJS ui-select</code> because it offers a large set of customizable features.
			</p>
			<p>
				The exact list of dependencies which can be found in the bower.json file is:
				<ul class="lui unstyled">
					<li><a class="lui fancy link" href="https://github.com/LuccaSA/lucca-icons">lucca-icons</a> <span class="lui label">1.1</span></li>
					<li><a class="lui fancy link" href="https://angularjs.org/">angular</a> <span class="lui label">1.4</span></li>
					<li><a class="lui fancy link" href="https://angular-ui.github.io/bootstrap/">angular ui bootstrap</a> <span class="lui label">0.13</span></li>
					<li><a class="lui fancy link" href="http://momentjs.com/">momentjs</a> <span class="lui label">2.10</span></li>
					<li><a class="lui fancy link" href="http://underscorejs.org/">underscorejs</a> <span class="lui label">1.8</span></li>
					<li><a class="lui fancy link" href="https://github.com/angular-ui/ui-select">ui-select</a> <span class="lui label">0.13</span></li>
					<li><a class="lui fancy link" href="https://github.com/angular/bower-angular-sanitize">angular sanitize</a> <span class="lui label">1.4</span></li>
					<li><a class="lui fancy link" href="https://github.com/angular-translate/angular-translate">angular translate</a> <span class="lui label">2.8</span></li>
				</ul>
			</p>
		</div>

	<article id="luid-user-picker">
		<h2 class="lui divider below">luid-user-picker</h2>

		<p>
			An input to have a ui-select plugged to <code>/api/v3/users/find</code> with a more powerful search and very amazing features.
		</p>
		<div class="lui dashed divider">
			<h4 class="lui underline">Features:</h4>
		</div>
		<p>
			Supports up and down key events to select a value.
		</p>
		<p>
			Detects and handles homonyms. When homonyms are detected, specific user informations are displayed in order to easily differentiate them. These informations are not initially retrieved by the query to <code>/api/v3/users/find</code> but they will be fetched with a single query to <code>/api/v3/users</code> with the ids of the homonyms. By default, the list of properties to display is <code>department.name, legalEntity.name, employeeNumber, mail</code>. The two first properties that differentiate the homonyms will be displayed. A couple of properties is considered as differentiating if at least one property value is different from the others and each couple of properties is unique among all homonyms. For example, if you have two users 'Lucien Bertin' whose properties are:
			<ul class="lui unstyled">
				<li><code>{ id: 1, name: 'Lucien Bertin', legalEntity: { name: 'Lucca' }, department: { name: 'BU Timmi/Lucca' }, employeeNumber: 58, mail: 'no-reply@lucca.fr' }</code></li>
				<li><code>{ id: 2, name: 'Lucien Bertin', legalEntity: { name: 'Lucca' }, department: { name: 'Sales' }, employeeNumber: 72, mail: 'no-reply@lucca.fr' }</code></li>
			</ul>
			The differentiating properties are <code>deparment.name</code> and <code>employeeNumber</code>. <code>legalEntity.name</code> is not differentiating because all values are the same among homonyms.
		</p>
		<p>
			Supports a list of custom properties to handle homonyms. If homonyms are detected, the differentiating properties will be displayed from that list. <b>Warning:</b> there is no control executed to check that given properties exist in <code>user</code> object. If the properties do not exist, the server will send back an error and no properties will be displayed. Go to <a class="lui fancy link" href="https://lucca.ilucca.net/apihelp#/users">apiHelp/users</a> to see the different properties that are supported.
		</p>
		<p>
			You can choose to fetch former employees. By default, only users who are still in the company are displayed. If you want to display former employees, their date of contract end will be displayed below their name.
		</p>
		<p>
			Handles pagination. By default, only 5 users are displayed in the dropdown menu. If more users match the query, a message is displayed at the end of the list indicating that there are more results, encouraging the user to specify his search.
		</p>
		<div class="lui dashed divider">
			<h4 class="lui underline">Supported arguments:</h4>
		</div>
		<p>
			<ul class="lui unstyled">
				<li><code>ng-model</code>: the variable to bind to</li>
				<li><code>on-select</code>: function to execute when an item is selected</li>
				<li><code>on-remove</code>: function to execute when an item is removed</li>
				<li><code>control-disabled</code>: boolean indicating if you want the control to be disabled</li>
				<li><code>show-former-employees</code>: boolean indicating if you want to fetch former employees or not</li>
				<li><code>custom-properties</code>: list of properties you want to display in case of homonyms</li>
			</ul>
		</p>
		<div class="lui dashed divider">
			<h4 class="lui underline">Usage:</h4>
		</div>
		<p>
			<pre ng-non-bindable>&lt;luid-user-picker ng-model="myUser"&gt;&lt;/luid-user-picker&gt;
&lt;luid-user-picker ng-model="myUser" show-former-employees="true"&gt;&lt;/luid-user-picker&gt;
&lt;luid-user-picker ng-model="myUser" custom-properties="manager.name,mail,birthdate"&gt;&lt;/luid-user-picker&gt;</pre>
		</p>
		<div class="lui dashed divider">
			<h4 class="lui underline">Demo:</h4>
		</div>
		<div ng-controller="userPickerCtrl" class="lui block round">
			<p>
				Reroute all calls to
				<span class="lui input with addons">
					<span class="lui addon">http://</span>
					<input type="text" class="lui input" ng-model="local" ng-change="authToken = ''">
					<span class="lui addon">.local</span>
				</span>
				<span class="lui button" ng-click="auth()" ng-show="!authToken">authenticate</span>
				<span class="lui green label with addon"ng-show="!!authToken"><i class="lui addon icon check"></i>authenticated</span><br>
				<b>Important:</b> your local website must implpement the api <code>/api/v3/users/find</code> for it to work. This feature is available on branch <a class="lui fancy link" href="https://github.com/LuccaSA/ilucca/tree/rc">rc</a> (since <a class="lui fancy link" href="https://github.com/LuccaSA/ilucca/pull/528#event-443784814">10/23/2015</a>) and <a class="lui fancy link" href="https://github.com/LuccaSA/ilucca/tree/master">master</a> (since 10/30/2015).
			</p>
			<p>
				<luid-user-picker class="lui input" ng-model="myUser.selected" show-former-employees="isChecked"></luid-user-picker>
				<input type="checkbox" ng-model="isChecked">Show former employees
			</p>
			<p>
				Selected user: <code>{{myUser.selected.firstName}} {{myUser.selected.lastName}}</code>
			</p>
		</div>
		<div class="lui dashed divider">
			<h4 class="lui underline">Roadmap:</h4>
		</div>
		<p>
			Here are a list of features we plan to add soon.
		</p>
		<h5>Filter on a permission's scope</h5>
		<p>
			Sometimes you want to restrict the list of available options to user you can perform certain actions on. For cleemy/expenses for example i will want to limit to users for whom i can consult expenses.
		</p>
		<h5>Specific filters</h5>
		<p>
			Let's take the example of cleemy/expenses again, you might want to see in the user-picker only users who have some expenses. This filter is specific to cleemy and used in one page only so implementing it server side is not recommended.
		</p>
		<p>
			By allowing the directive to take an argument <code>customFilter = function ( user ) { return true/false; }</code> we can let the directive call the api to get all pertinent users for the search, then filter them to display only the ones you want. I'll put a demo of this feature once it is available
		</p>
		<h5>Multi-select</h5>
		<p>
			This one is pretty much self explanatory.
		</p>
		<h5>Some optimisations</h5>
		<p>
			We don't really know how heavy this directive is for the server or for the client. We already have some leads on how to optimize certain aspects (the pagination for example) but we don't know if it is really necessary to focus on that now
		</p>
		<div class="lui dashed divider">
			<h4 class="lui underline">Side notes:</h4>
		</div>
		<p>
			The directive is tested with karma (18 tests so far) and protractor (8 tests) and should be stable. Follow the release notes of each version of the <a class="lui fancy link" href="https://github.com/LuccaSA/lucca-ui/releases">bower component</a> to know what feature was added and which bug was fixed.
		</p>
	</article>
</section>
</div>
